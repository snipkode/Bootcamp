<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fullstack Mobile Bootcamp - SKT Bootcamp Academy</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Markdown Parser (Marked) for AI Response -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(to right, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Custom scrollbar for AI response area */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5); 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
        
        /* Markdown Styles */
        .prose h3 { color: #e2e8f0; font-weight: 700; margin-top: 1em; margin-bottom: 0.5em; }
        .prose p { margin-bottom: 0.8em; color: #cbd5e1; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; color: #cbd5e1; }
        .prose strong { color: #60a5fa; }
    </style>
</head>
<body class="bg-slate-900 text-slate-50 font-sans antialiased">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 hidden-on-login">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <div class="bg-brand-600 text-white p-1.5 rounded-lg font-bold text-xl">
                        <i class="fa-solid fa-code"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight">SKT <span class="text-brand-500">Academy</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="#home" class="hover:text-brand-400 transition px-3 py-2 font-medium">Beranda</a>
                        <a href="#curriculum" class="hover:text-brand-400 transition px-3 py-2 font-medium">Kurikulum</a>
                        <a href="#ai-consultant" class="text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-400 font-bold hover:opacity-80 transition px-3 py-2">
                            <i class="fa-solid fa-sparkles mr-1"></i> Tanya AI
                        </a>
                        <!-- Registration button shown only when not logged in or not completed registration -->
                        <a id="registerButton" href="#cta" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-full font-medium transition shadow-lg shadow-brand-500/30">Daftar Sekarang</a>
                        <!-- User panel shown only when logged in -->
                        <div id="userPanel" class="hidden flex items-center space-x-4">
                            <a href="#" id="dashboardButton" class="hover:text-amber-400 transition px-3 py-2 font-medium hidden">
                                <i class="fa-solid fa-table-columns mr-1"></i> Dashboard
                            </a>
                            <button id="logoutButton" onclick="signOut()" class="hover:text-rose-400 transition px-3 py-2 font-medium hidden flex items-center gap-1">
                                <i class="fa-solid fa-right-from-bracket mr-1"></i> Logout
                            </button>
                            <div class="relative group">
                                <button id="userMenuButton" class="flex items-center space-x-1 text-slate-300 hover:text-white">
                                    <div id="userAvatar" class="w-8 h-8 rounded-full bg-brand-600 flex items-center justify-center text-white text-sm font-bold">
                                        <i class="fa-solid fa-user"></i>
                                    </div>
                                    <span id="userNameDisplay" class="text-sm"></span>
                                    <i class="fas fa-chevron-down ml-1 text-xs"></i>
                                </button>
                                <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-slate-800 border border-slate-700 rounded-lg shadow-lg py-2 hidden group-hover:block z-50">
                                    <a href="#" id="viewProfileLink" class="block px-4 py-2 text-slate-300 hover:bg-slate-700 hover:text-white">Lihat Profil</a>
                                    <a href="#" id="settingsLink" class="block px-4 py-2 text-slate-300 hover:bg-slate-700 hover:text-white">Pengaturan</a>
                                    <a href="#" id="logoutLink" class="block px-4 py-2 text-slate-300 hover:bg-red-600 hover:text-white" onclick="signOut()">Keluar</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="home" class="relative pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden hidden-on-login">
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10">
            <div class="absolute top-[-10%] right-[-5%] w-96 h-96 bg-brand-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
            <div class="absolute top-[20%] left-[-10%] w-72 h-72 bg-purple-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <span class="inline-block py-1 px-3 rounded-full bg-brand-900/50 border border-brand-700 text-brand-300 text-sm font-semibold mb-6">
                ðŸš€ Roadmap 12 Minggu Menjadi Expert
            </span>
            <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold tracking-tight mb-6">
                Kuasai <span class="gradient-text">Fullstack Mobile</span> <br> & Backend Development
            </h1>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-slate-400 mb-10">
                Transformasi dari Developer JavaScript menjadi Fullstack Engineer siap produksi dengan Docker, Express.js, dan React Native.
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#curriculum" class="px-8 py-4 bg-white text-slate-900 rounded-full font-bold hover:bg-gray-100 transition shadow-xl">
                    Lihat Roadmap
                </a>
                <a href="#ai-consultant" class="px-8 py-4 bg-slate-800 text-white border border-slate-700 rounded-full font-bold hover:bg-slate-700 transition shadow-lg flex items-center justify-center gap-2 group">
                    <i class="fa-solid fa-sparkles text-purple-400 group-hover:animate-pulse"></i> Cek Kecocokan Karir
                </a>
            </div>
        </div>
    </header>

    <!-- Tech Stack Logos -->
    <div id="stack" class="py-10 border-y border-slate-800 bg-slate-800/30 hidden-on-login">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm font-semibold uppercase tracking-wider mb-6">Tech Stack Modern yang Akan Anda Pelajari</p>
            <div class="flex flex-wrap justify-center gap-8 md:gap-16 opacity-70 grayscale hover:grayscale-0 transition-all duration-500">
                <div class="flex flex-col items-center gap-2 hover:text-blue-400 transition">
                    <i class="fa-brands fa-docker text-4xl"></i>
                    <span class="text-xs font-semibold">Docker</span>
                </div>
                <div class="flex flex-col items-center gap-2 hover:text-yellow-400 transition">
                    <i class="fa-brands fa-js text-4xl"></i>
                    <span class="text-xs font-semibold">Express.js</span>
                </div>
                <div class="flex flex-col items-center gap-2 hover:text-cyan-400 transition">
                    <i class="fa-brands fa-react text-4xl"></i>
                    <span class="text-xs font-semibold">React Native</span>
                </div>
                <div class="flex flex-col items-center gap-2 hover:text-blue-300 transition">
                    <i class="fa-solid fa-database text-4xl"></i>
                    <span class="text-xs font-semibold">PostgreSQL</span>
                </div>
                <div class="flex flex-col items-center gap-2 hover:text-green-500 transition">
                    <i class="fa-solid fa-server text-4xl"></i>
                    <span class="text-xs font-semibold">Nginx</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Curriculum Section -->
    <section id="curriculum" class="py-20 relative hidden-on-login">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">Kurikulum Intensif 12 Minggu</h2>
                <p class="text-slate-400 max-w-2xl mx-auto">
                    Disusun bertahap mulai dari fundamental hingga deployment production untuk memastikan Anda siap kerja.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Fase 1 -->
                <div class="glass-card p-8 rounded-2xl hover:border-brand-500/50 transition-colors duration-300 group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                        <i class="fa-solid fa-layer-group text-8xl text-brand-500"></i>
                    </div>
                    <h3 class="text-brand-400 font-bold tracking-wide uppercase text-sm mb-2">Fase 1 â€¢ Minggu 1-2</h3>
                    <h4 class="text-2xl font-bold text-white mb-6">Fundamental Foundation</h4>
                    
                    <div class="space-y-6">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-brand-900/50 flex items-center justify-center text-brand-400 font-bold border border-brand-700">1</div>
                            <div>
                                <h5 class="font-semibold text-white">Docker Basics</h5>
                                <p class="text-sm text-slate-400 mt-1">Container, Image, Volume, Network, Basic Command.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-brand-900/50 flex items-center justify-center text-brand-400 font-bold border border-brand-700">2</div>
                            <div>
                                <h5 class="font-semibold text-white">Express.js Basics</h5>
                                <p class="text-sm text-slate-400 mt-1">Routing, Middleware, Struktur Folder, REST API sederhana.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fase 2 -->
                <div class="glass-card p-8 rounded-2xl hover:border-brand-500/50 transition-colors duration-300 group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                        <i class="fa-solid fa-code text-8xl text-purple-500"></i>
                    </div>
                    <h3 class="text-purple-400 font-bold tracking-wide uppercase text-sm mb-2">Fase 2 â€¢ Minggu 3-6</h3>
                    <h4 class="text-2xl font-bold text-white mb-6">Core Skills Mastery</h4>
                    
                    <div class="space-y-6">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-400 font-bold border border-purple-700">3</div>
                            <div>
                                <h5 class="font-semibold text-white">Advanced Express</h5>
                                <p class="text-sm text-slate-400 mt-1">CRUD, Validation, Error Handling, Env Config.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-400 font-bold border border-purple-700">4</div>
                            <div>
                                <h5 class="font-semibold text-white">Docker Orchestration</h5>
                                <p class="text-sm text-slate-400 mt-1">Dockerfile & Docker Compose untuk Database + API.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-400 font-bold border border-purple-700">5-6</div>
                            <div>
                                <h5 class="font-semibold text-white">React Native Fundamentals</h5>
                                <p class="text-sm text-slate-400 mt-1">Expo, Komponen Inti, Styling, Navigasi & Integrasi API.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fase 3 -->
                <div class="glass-card p-8 rounded-2xl hover:border-brand-500/50 transition-colors duration-300 group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                        <i class="fa-solid fa-shield-halved text-8xl text-green-500"></i>
                    </div>
                    <h3 class="text-green-400 font-bold tracking-wide uppercase text-sm mb-2">Fase 3 â€¢ Minggu 7-9</h3>
                    <h4 class="text-2xl font-bold text-white mb-6">Auth & Integration</h4>
                    
                    <div class="space-y-6">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-900/50 flex items-center justify-center text-green-400 font-bold border border-green-700">7</div>
                            <div>
                                <h5 class="font-semibold text-white">Backend Security</h5>
                                <p class="text-sm text-slate-400 mt-1">Authentication (JWT, Bcrypt) & Authorization Middleware.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-900/50 flex items-center justify-center text-green-400 font-bold border border-green-700">8</div>
                            <div>
                                <h5 class="font-semibold text-white">Mobile Auth Flow</h5>
                                <p class="text-sm text-slate-400 mt-1">Login Screen, Token Management, Protected Routes.</p>
                            </div>
                        </div>
                         <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-900/50 flex items-center justify-center text-green-400 font-bold border border-green-700">9</div>
                            <div>
                                <h5 class="font-semibold text-white">End-to-End Integration</h5>
                                <p class="text-sm text-slate-400 mt-1">Full flow: Mobile App â†’ REST API â†’ Database.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fase 4 -->
                <div class="glass-card p-8 rounded-2xl hover:border-brand-500/50 transition-colors duration-300 group relative overflow-hidden border-t-4 border-t-yellow-500">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                        <i class="fa-solid fa-rocket text-8xl text-yellow-500"></i>
                    </div>
                    <h3 class="text-yellow-400 font-bold tracking-wide uppercase text-sm mb-2">Fase 4 â€¢ Minggu 10-12</h3>
                    <h4 class="text-2xl font-bold text-white mb-6">Production & Portfolio</h4>
                    
                    <div class="space-y-6">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-yellow-900/50 flex items-center justify-center text-yellow-400 font-bold border border-yellow-700">10</div>
                            <div>
                                <h5 class="font-semibold text-white">Production DevOps</h5>
                                <p class="text-sm text-slate-400 mt-1">Multi-stage build, Nginx Reverse Proxy, Basic SSL.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-yellow-900/50 flex items-center justify-center text-yellow-400 font-bold border border-yellow-700">11</div>
                            <div>
                                <h5 class="font-semibold text-white">Mobile Release</h5>
                                <p class="text-sm text-slate-400 mt-1">Build APK/AAB, UI Polish, Performance Optimization.</p>
                            </div>
                        </div>
                         <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-yellow-900/50 flex items-center justify-center text-yellow-400 font-bold border border-yellow-700">12</div>
                            <div>
                                <h5 class="font-semibold text-white">Final Capstone Project</h5>
                                <p class="text-sm text-slate-400 mt-1">Portfolio Fullstack yang siap dipresentasikan untuk kerja.</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- GEMINI AI SECTION -->
    <section id="ai-consultant" class="py-20 relative bg-slate-900 border-t border-slate-800 hidden-on-login">
        <!-- Decoration -->
        <div class="absolute left-0 bottom-0 w-full h-full overflow-hidden pointer-events-none">
             <div class="absolute bottom-[-10%] left-[-5%] w-96 h-96 bg-purple-900/20 rounded-full mix-blend-screen filter blur-3xl opacity-30"></div>
        </div>

        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center mb-10">
                <span class="inline-block py-1 px-3 rounded-full bg-purple-900/30 border border-purple-500/30 text-purple-300 text-xs font-semibold mb-4 uppercase tracking-wider">
                    <i class="fa-solid fa-sparkles mr-2"></i>Powered by Gemini AI
                </span>
                <h2 class="text-3xl md:text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-400">
                    Konsultan Karir AI Personal
                </h2>
                <p class="text-slate-400 max-w-2xl mx-auto">
                    Ragu apakah bootcamp ini cocok untuk Anda? Ceritakan latar belakang coding Anda (jujur saja!), dan AI kami akan menganalisis potensi kesuksesan Anda di roadmap 12 minggu ini.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                <!-- Input Column -->
                <div class="md:col-span-2 space-y-4">
                    <div class="glass-card p-6 rounded-xl border-purple-500/20">
                        <label class="block text-sm font-medium text-slate-300 mb-2">Background & Skill Saat Ini</label>
                        <textarea id="user-background" rows="4" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg p-3 text-slate-200 focus:ring-2 focus:ring-purple-500 focus:outline-none transition resize-none text-sm" placeholder="Contoh: Saya mahasiswa semester 5, sudah pernah belajar HTML/CSS dasar tapi belum paham Backend. Ingin jadi freelancer."></textarea>
                        
                        <button onclick="analyzeProfile()" id="analyze-btn" class="mt-4 w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-lg shadow-lg shadow-purple-900/40 transition flex items-center justify-center gap-2 group">
                            <span>Analisa Profil Saya</span>
                            <i class="fa-solid fa-wand-magic-sparkles group-hover:rotate-12 transition"></i>
                        </button>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                        <div class="flex items-start gap-3">
                            <i class="fa-solid fa-circle-info text-slate-400 mt-1"></i>
                            <p class="text-xs text-slate-400">AI akan mencocokkan profil Anda dengan Fase 1-4 kurikulum untuk memberikan strategi belajar yang efektif.</p>
                        </div>
                    </div>
                </div>

                <!-- Output Column -->
                <div class="md:col-span-3">
                    <div class="h-full min-h-[300px] glass-card rounded-xl p-6 relative border-purple-500/20 flex flex-col">
                        <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-700/50">
                            <h3 class="font-bold text-white flex items-center gap-2">
                                <i class="fa-solid fa-robot text-purple-400"></i> Hasil Analisa AI
                            </h3>
                            <div id="loading-indicator" class="hidden">
                                <div class="flex items-center gap-2 text-xs text-purple-300 animate-pulse">
                                    <i class="fa-solid fa-circle-notch fa-spin"></i> Sedang berpikir...
                                </div>
                            </div>
                        </div>
                        
                        <!-- Content Area -->
                        <div id="ai-response" class="prose prose-invert prose-sm max-w-none flex-grow overflow-y-auto custom-scrollbar pr-2">
                            <div class="flex flex-col items-center justify-center h-full text-slate-500 space-y-3 opacity-60">
                                <i class="fa-regular fa-comment-dots text-4xl"></i>
                                <p class="text-center text-sm">Masukan background Anda di sebelah kiri untuk mendapatkan analisa personal.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Outcome Section -->
    <section class="py-20 bg-slate-800 hidden-on-login">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <h2 class="text-3xl font-bold mb-8">Apa yang akan Anda Bawa Pulang?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-6 bg-slate-700 rounded-xl border border-slate-600">
                    <i class="fa-solid fa-mobile-screen text-4xl text-brand-400 mb-4"></i>
                    <h3 class="font-bold text-lg mb-2">Aplikasi Mobile</h3>
                    <p class="text-sm text-slate-400">Aplikasi React Native (Expo) yang terinstall di perangkat Anda.</p>
                </div>
                <div class="p-6 bg-slate-700 rounded-xl border border-slate-600">
                    <i class="fa-solid fa-server text-4xl text-brand-400 mb-4"></i>
                    <h3 class="font-bold text-lg mb-2">Backend API</h3>
                    <p class="text-sm text-slate-400">Server Express.js aman dengan dokumentasi lengkap.</p>
                </div>
                <div class="p-6 bg-slate-700 rounded-xl border border-slate-600">
                    <i class="fa-brands fa-docker text-4xl text-brand-400 mb-4"></i>
                    <h3 class="font-bold text-lg mb-2">DevOps Skill</h3>
                    <p class="text-sm text-slate-400">Pemahaman mendalam tentang Containerization & Deployment.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section id="cta" class="py-24 relative overflow-hidden hidden-on-login">
        <div class="absolute inset-0 bg-brand-600 opacity-10"></div>
        <div class="max-w-4xl mx-auto px-4 text-center relative z-10">
            <h2 class="text-4xl font-bold mb-6">Siap Mengubah Karir Anda?</h2>
            <p class="text-xl text-slate-300 mb-10">
                Jangan lewatkan kesempatan untuk menguasai skill yang paling dicari industri saat ini.
                12 Minggu, Fokus Praktik, Siap Kerja.
            </p>
            <button onclick="openRegistrationForm()" class="px-10 py-5 bg-brand-600 hover:bg-brand-500 text-white font-bold rounded-full text-lg shadow-xl shadow-brand-600/40 transition transform hover:-translate-y-1">
                Daftar Sekarang
            </button>
            <p class="mt-4 text-sm text-slate-500">Batch baru dimulai setiap bulan. Kuota terbatas.</p>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="py-20 bg-gradient-to-br from-slate-900 to-slate-800 hidden-on-login">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Benefit Yang Akan Anda Dapatkan</h2>
                <p class="text-slate-400 max-w-2xl mx-auto">
                    Bergabunglah dengan bootcamp kami dan raih karir impian Anda di dunia teknologi
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-gradient-to-br from-green-500/10 to-blue-500/10 border border-green-500/20 rounded-2xl p-6 backdrop-blur-sm">
                    <h3 class="font-bold text-white mb-4 flex items-center gap-3 text-xl">
                        <i class="fa-solid fa-gift text-green-400 text-2xl"></i> Apa Saja Benefitnya?
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-start gap-3">
                            <i class="fa-solid fa-certificate text-green-400 mt-1 text-lg"></i>
                            <div>
                                <h5 class="font-semibold text-white">Sertifikat Kelulusan</h5>
                                <p class="text-sm text-slate-400">Sertifikat resmi yang dapat ditampilkan di LinkedIn dan CV Anda</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <i class="fa-solid fa-briefcase text-blue-400 mt-1 text-lg"></i>
                            <div>
                                <h5 class="font-semibold text-white">Rekomendasi Kerja</h5>
                                <p class="text-sm text-slate-400">Akses ke jaringan perusahaan mitra untuk peluang kerja</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <i class="fa-solid fa-file-lines text-purple-400 mt-1 text-lg"></i>
                            <div>
                                <h5 class="font-semibold text-white">Bantuan Pembuatan CV</h5>
                                <p class="text-sm text-slate-400">Template CV profesional dan bimbingan penulisan</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <i class="fa-solid fa-laptop-code text-amber-400 mt-1 text-lg"></i>
                            <div>
                                <h5 class="font-semibold text-white">Personal Website</h5>
                                <p class="text-sm text-slate-400">Website portfolio profesional untuk menampilkan proyek Anda</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 pt-6 border-t border-green-500/20">
                        <a href="https://kodeku.web.app" target="_blank" class="inline-flex items-center justify-center gap-3 text-green-400 hover:text-green-300 font-medium">
                            <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            <span>Lihat Portofolio Instruktur</span>
                        </a>
                    </div>
                </div>

                <!-- Instructor Info -->
                <div class="bg-gradient-to-br from-indigo-900/30 to-purple-900/30 border-2 border-indigo-500/30 rounded-2xl p-6 backdrop-blur-sm">
                    <h3 class="font-bold text-white mb-6 flex items-center gap-3 text-xl">
                        <i class="fa-solid fa-chalkboard-user text-amber-400"></i> Instruktur Profesional
                    </h3>

                    <div class="flex flex-col items-center text-center gap-6">
                        <div class="bg-gradient-to-br from-indigo-700 to-purple-800 border-2 border-indigo-500 rounded-full w-28 h-28 flex items-center justify-center text-white text-3xl">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div class="w-full">
                            <h4 class="font-bold text-xl sm:text-2xl text-white mb-2">Alam Santiko Wibowo, S.Kom., S.H.</h4>
                            <p class="text-lg text-indigo-200 mb-2">IT Senior Fullstack Developer</p>
                            <p class="text-base text-indigo-300">Great Eastern Life Insurance</p>

                            <div class="mt-6 pt-6 border-t border-indigo-500/30">
                                <p class="text-sm text-indigo-200 italic mb-4">
                                    Pengalaman lebih dari 10 tahun di bidang pengembangan perangkat lunak dan keamanan informasi
                                </p>

                                <div class="flex justify-center">
                                    <a href="https://www.linkedin.com/in/alam-santiko-wibowo" target="_blank" class="inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200 transition bg-indigo-800/30 px-4 py-2 rounded-lg">
                                        <i class="fa-brands fa-linkedin"></i>
                                        <span>Lihat Profil LinkedIn</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Registration Form Modal -->
    <div id="registrationModal" class="fixed inset-0 bg-black bg-opacity-70 hidden z-50 flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl max-w-2xl w-full mx-4 my-8 border border-brand-500 relative shadow-2xl">
            <div class="p-6 md:p-8 max-h-[90vh] overflow-y-auto">
            <button onclick="closeRegistrationForm()" class="absolute top-4 right-4 text-slate-400 hover:text-brand-600">
                <i class="fas fa-times text-xl"></i>
            </button>

            <h3 class="text-2xl font-bold text-center mb-2 text-brand-700">Form Pendaftaran</h3>

            <div class="text-center mb-6">
                <p class="text-slate-600 text-sm">Bootcamp Fullstack Mobile Development</p>
            </div>


            <!-- Payment Info Box with Emotional Pricing -->
            <div class="bg-gradient-to-r from-red-50 to-yellow-50 border border-red-200 rounded-xl p-5 mb-6 text-center relative overflow-hidden">
                <!-- Decorative elements -->
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 to-yellow-500"></div>

                <h4 class="font-bold text-red-800 mb-3 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-fire text-red-600"></i> Harga Spesial Hari Ini!
                </h4>

                <div class="mb-3">
                    <p class="line-through text-red-500 text-sm">Rp 25.000.000</p>
                    <p class="text-3xl font-extrabold text-green-600 mt-1">Rp 5.000.000</p>
                    <p class="text-xs text-slate-600 mt-1">Hemat lebih dari 80%</p>
                </div>

                <div class="bg-red-100 border border-red-300 rounded-lg p-3 mb-3">
                    <p class="text-red-700 font-bold text-sm">Penawaran Berakhir Dalam:</p>
                    <div id="countdownTimer" class="flex flex-wrap justify-center gap-2 mt-2">
                        <div class="flex flex-col items-center">
                            <span class="bg-red-600 text-white font-bold w-8 h-8 flex items-center justify-center rounded md:w-10 md:h-10">14</span>
                            <span class="text-xs text-slate-600 mt-1">Hari</span>
                        </div>
                        <span class="text-xl text-red-600 font-bold md:text-2xl">:</span>
                        <div class="flex flex-col items-center">
                            <span class="bg-red-600 text-white font-bold w-8 h-8 flex items-center justify-center rounded md:w-10 md:h-10">00</span>
                            <span class="text-xs text-slate-600 mt-1">Jam</span>
                        </div>
                        <span class="text-xl text-red-600 font-bold md:text-2xl">:</span>
                        <div class="flex flex-col items-center">
                            <span class="bg-red-600 text-white font-bold w-8 h-8 flex items-center justify-center rounded md:w-10 md:h-10">00</span>
                            <span class="text-xs text-slate-600 mt-1">Min</span>
                        </div>
                        <span class="text-xl text-red-600 font-bold md:text-2xl">:</span>
                        <div class="flex flex-col items-center">
                            <span class="bg-red-600 text-white font-bold w-8 h-8 flex items-center justify-center rounded md:w-10 md:h-10">00</span>
                            <span class="text-xs text-slate-600 mt-1">Det</span>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <p class="text-sm text-slate-700 font-semibold">Cicilan Tersedia:</p>
                    <p class="text-xs text-slate-600">DP Min. 20% (Rp 1.000.000) & Sisa Cicilan Rp 1.000.000/Bulan</p>
                </div>

                <p class="text-sm text-slate-700">Dapatkan semua benefit termasuk sertifikat & rekomendasi kerja!</p>
            </div>

            <!-- Google Login Section -->
            <div id="google-login-section" class="mb-6">
                <div id="google-login-btn" class="block">
                    <button
                        type="button"
                        onclick="signInWithGoogle()"
                        class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-3"
                    >
                        <i class="fab fa-google"></i> Daftar dengan Google
                    </button>
                </div>
                <div id="user-info" class="hidden"></div>
            </div>

            <!-- Profile Completion Form -->
            <div id="profileCompletion" class="profile-step">
                <h3 class="text-xl font-bold text-center mb-6 text-brand-600">Lengkapi Profil Anda</h3>

                <form id="profileCompletionForm">
                    <div class="mb-4">
                        <label for="fullName" class="block text-slate-700 mb-2 font-medium">Nama Lengkap</label>
                        <input
                            type="text"
                            id="fullName"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            placeholder="Masukkan nama lengkap Anda"
                            required
                        >
                    </div>

                    <div class="mb-4">
                        <label for="email" class="block text-slate-700 mb-2 font-medium">Email</label>
                        <input
                            type="email"
                            id="email"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            placeholder="Masukkan email Anda"
                            required
                        >
                    </div>

                    <div class="mb-4">
                        <label for="phone" class="block text-slate-700 mb-2 font-medium">Nomor WhatsApp</label>
                        <input
                            type="tel"
                            id="phone"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            placeholder="Masukkan nomor WhatsApp Anda"
                            required
                        >
                    </div>

                    <div class="mb-6">
                        <label for="address" class="block text-slate-700 mb-2 font-medium">Alamat Lengkap</label>
                        <textarea
                            id="address"
                            rows="3"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition resize-none"
                            placeholder="Masukkan alamat lengkap Anda"
                            required
                        ></textarea>
                    </div>

                    <button
                        type="submit"
                        class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-lg shadow-lg shadow-brand-500/30 transition"
                    >
                        Simpan Profil dan Lanjutkan <i class="fa-solid fa-arrow-right ml-2"></i>
                    </button>

                    <p class="text-center text-xs text-slate-500 mt-3">
                        Data Anda akan kami jaga kerahasiaannya
                    </p>
                </form>
            </div>

            <!-- DP Payment Section -->
            <div id="dpPaymentSection" class="profile-step hidden">
                <h3 class="text-xl font-bold text-center mb-6 text-emerald-600">Pembayaran DP (20%)</h3>

                <div class="mb-6 bg-slate-100 p-4 rounded-lg">
                    <h4 class="font-bold text-slate-800 mb-2">Rincian Pembayaran</h4>
                    <div class="flex justify-between mb-1">
                        <span class="text-slate-600">Total Biaya Program:</span>
                        <span class="font-bold">Rp 5.000.000</span>
                    </div>
                    <div class="flex justify-between mb-1">
                        <span class="text-slate-600">Down Payment (20%):</span>
                        <span class="font-bold">Rp 1.000.000</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-600">Cicilan (4x):</span>
                        <span class="font-bold">Rp 1.000.000/bulan</span>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold text-slate-800 mb-3">Metode Pembayaran DP</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <button type="button" class="payment-method-btn py-3 bg-slate-200 hover:bg-slate-300 text-slate-800 font-medium rounded-lg transition active:bg-slate-400" data-method="bank_transfer">
                            <i class="fa-solid fa-building-columns mr-2"></i>Transfer Bank
                        </button>
                        <button type="button" class="payment-method-btn py-3 bg-slate-200 hover:bg-slate-300 text-slate-800 font-medium rounded-lg transition active:bg-slate-400" data-method="e_wallet">
                            <i class="fa-solid fa-wallet mr-2"></i>E-Wallet
                        </button>
                        <button type="button" class="payment-method-btn py-3 bg-slate-200 hover:bg-slate-300 text-slate-800 font-medium rounded-lg transition active:bg-slate-400" data-method="virtual_account">
                            <i class="fa-solid fa-hashtag mr-2"></i>Virtual Account
                        </button>
                    </div>
                    <input type="hidden" id="selectedPaymentMethod" value="">
                </div>

                <div class="mb-6">
                    <h4 class="font-bold text-slate-800 mb-3">Upload Bukti Transfer DP</h4>
                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-8 text-center cursor-pointer hover:bg-slate-50 transition" onclick="document.getElementById('proofUpload').click()">
                        <i class="fa-solid fa-cloud-arrow-up text-slate-400 text-4xl mb-3"></i>
                        <p class="text-slate-600">Klik untuk upload bukti transfer DP</p>
                        <p class="text-sm text-slate-500 mt-1">Format: JPG, PNG, PDF (Max 5MB)</p>
                        <input type="file" id="proofUpload" class="hidden" accept="image/*,.pdf">
                    </div>
                    <div id="uploadedProofPreview" class="mt-3 hidden">
                        <div class="flex items-center justify-between bg-slate-100 p-3 rounded-lg">
                            <div class="flex items-center">
                                <i class="fa-solid fa-file-image text-blue-500 mr-2"></i>
                                <span id="fileName" class="text-slate-700"></span>
                            </div>
                            <button type="button" onclick="removeProof()" class="text-red-500 hover:text-red-700">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button
                        type="button"
                        onclick="goToProfileStep()"
                        class="flex-1 py-3 bg-slate-500 hover:bg-slate-600 text-white font-bold rounded-lg transition"
                    >
                        <i class="fa-solid fa-arrow-left mr-2"></i> Kembali
                    </button>
                    <button
                        type="button"
                        onclick="submitDPayment()"
                        class="flex-1 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg shadow-lg shadow-emerald-500/30 transition"
                    >
                        Kirim Bukti Pembayaran <i class="fa-solid fa-paper-plane ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Submission Confirmation -->
            <div id="submissionConfirmation" class="profile-step hidden">
                <h3 class="text-xl font-bold text-center mb-6 text-amber-600">Menunggu Verifikasi</h3>

                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-hourglass-half text-amber-500 text-3xl"></i>
                    </div>
                    <p class="text-slate-700 mb-2">Bukti pembayaran DP telah dikirim!</p>
                    <p class="text-slate-600 text-sm">Tim kami akan segera memverifikasi pembayaran Anda.</p>
                </div>

                <div class="mb-6 bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h4 class="font-bold text-amber-800 mb-2 flex items-center gap-2">
                        <i class="fa-solid fa-exclamation-triangle"></i> Proses Selanjutnya
                    </h4>
                    <ul class="text-amber-700 text-sm space-y-1">
                        <li class="flex items-start gap-2">
                            <i class="fa-solid fa-circle text-[0.5rem] mt-1.5"></i>
                            <span>Instruktur akan memverifikasi bukti pembayaran DP Anda</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fa-solid fa-circle text-[0.5rem] mt-1.5"></i>
                            <span>Setelah DP disetujui, Anda dapat mengakses materi pembelajaran</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fa-solid fa-circle text-[0.5rem] mt-1.5"></i>
                            <span>Pastikan WhatsApp Anda aktif untuk komunikasi lebih lanjut</span>
                        </li>
                    </ul>
                </div>

                <button
                    type="button"
                    onclick="finishProfileSetup()"
                    class="w-full py-3 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg shadow-lg shadow-amber-500/30 transition"
                >
                    Tutup dan Tunggu Verifikasi <i class="fa-solid fa-check ml-2"></i>
                </button>
            </div>
            </div> <!-- Closing div for scrollable container -->
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="hidden fixed inset-0 bg-slate-900 z-50 overflow-y-auto">
        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-white">Dashboard <span class="text-brand-500">Student</span></h1>
                <button onclick="signOut()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                    Logout
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Student Profile Card -->
                <div class="lg:col-span-1">
                    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                        <div class="flex flex-col items-center text-center mb-6">
                            <div class="bg-gradient-to-br from-indigo-700 to-purple-800 border-2 border-indigo-500 rounded-xl w-24 h-24 flex items-center justify-center text-white text-3xl mb-4">
                                <i class="fa-solid fa-user"></i>
                            </div>
                            <h2 id="dashboardFullName" class="text-xl font-bold text-white"></h2>
                            <p id="dashboardEmail" class="text-slate-400"></p>
                            <p id="dashboardPhone" class="text-slate-400"></p>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-slate-700 p-4 rounded-lg">
                                <h3 class="font-semibold text-slate-300 mb-2">Status Keanggotaan</h3>
                                <p class="text-green-400 font-medium">Aktif</p>
                            </div>

                            <div class="bg-slate-700 p-4 rounded-lg">
                                <h3 class="font-semibold text-slate-300 mb-2">Tanggal Bergabung</h3>
                                <p id="joinDate" class="text-slate-200"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="lg:col-span-2">
                    <!-- Payment Status Section -->
                    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-8">
                        <h2 class="text-xl font-bold text-white mb-4">Status Pembayaran</h2>
                        <div class="mb-6">
                            <div class="flex justify-between mb-2">
                                <span class="text-slate-300">Total Biaya: Rp 5.000.000</span>
                                <span id="overallPaymentStatus" class="text-slate-300 font-medium">Belum Dibayar</span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2.5">
                                <div id="paymentProgressBar" class="bg-yellow-500 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Down Payment -->
                            <div class="bg-slate-700 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-semibold text-slate-300">Down Payment (20%)</h3>
                                    <span id="dpStatus" class="px-2 py-1 text-xs rounded-full bg-yellow-900/30 text-yellow-400">Pending</span>
                                </div>
                                <p class="text-white font-bold">Rp 1.000.000</p>
                                <p id="dpDueDate" class="text-slate-400 text-sm">Jatuh tempo: -</p>
                                <button id="dpPayButton" class="mt-3 w-full py-2 bg-yellow-600 hover:bg-yellow-700 text-white text-sm rounded-lg transition hidden">
                                    Bayar Sekarang
                                </button>
                            </div>

                            <!-- Installments -->
                            <div class="bg-slate-700 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-semibold text-slate-300">Cicilan Bulanan</h3>
                                    <span id="installmentStatus" class="px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400">-</span>
                                </div>
                                <p class="text-white font-bold">Rp 1.000.000 x 4 bulan</p>
                                <p id="installmentInfo" class="text-slate-400 text-sm">Sisa: -</p>
                                <button id="installmentPayButton" class="mt-3 w-full py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition hidden">
                                    Bayar Cicilan
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Section -->
                    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-8 progress-section">
                        <h2 class="text-xl font-bold text-white mb-4">Progress Kamu</h2>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Fase 1: Fundamental Foundation</span>
                                    <span class="text-slate-300">75%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2.5">
                                    <div class="bg-brand-600 h-2.5 rounded-full" style="width: 75%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Fase 2: Core Skills Mastery</span>
                                    <span class="text-slate-300">30%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2.5">
                                    <div class="bg-brand-600 h-2.5 rounded-full" style="width: 30%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Fase 3: Auth & Integration</span>
                                    <span class="text-slate-300">0%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2.5">
                                    <div class="bg-brand-600 h-2.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Sessions Section -->
                    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-8" id="upcomingSessionsSection">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-white">Jadwal Sesi Mendatang</h2>
                            <button class="text-sm text-amber-400 hover:text-amber-300 flex items-center gap-1">
                                <i class="fa-solid fa-history mr-1"></i> Riwayat Sesi
                            </button>
                        </div>
                        <div class="space-y-4" id="upcomingSessionsList">
                            <!-- Upcoming sessions will be loaded here -->
                            <div class="text-center py-4 text-slate-500">
                                <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                                <p>Memuat jadwal sesi...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Payment History Section -->
                    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-8" id="paymentHistorySection">
                        <h2 class="text-xl font-bold text-white mb-4">Riwayat Pembayaran</h2>
                        <div class="space-y-4" id="paymentHistoryList">
                            <!-- Payment history will be loaded here -->
                            <div class="text-center py-4 text-slate-500">
                                <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                                <p>Memuat riwayat pembayaran...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Resources Section -->
                    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                        <h2 class="text-xl font-bold text-white mb-4">Resource Belajar</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <a href="#" class="bg-slate-700 hover:bg-slate-600 p-4 rounded-lg transition flex items-center gap-3">
                                <i class="fa-solid fa-book-open text-brand-500 text-xl"></i>
                                <span class="text-white">Modul Pembelajaran</span>
                            </a>
                            <a href="#" class="bg-slate-700 hover:bg-slate-600 p-4 rounded-lg transition flex items-center gap-3">
                                <i class="fa-solid fa-video text-purple-500 text-xl"></i>
                                <span class="text-white">Video Tutorial</span>
                            </a>
                            <a href="#" class="bg-slate-700 hover:bg-slate-600 p-4 rounded-lg transition flex items-center gap-3">
                                <i class="fa-solid fa-chalkboard-user text-green-500 text-xl"></i>
                                <span class="text-white">Live Session</span>
                            </a>
                            <a href="#" class="bg-slate-700 hover:bg-slate-600 p-4 rounded-lg transition flex items-center gap-3">
                                <i class="fa-solid fa-comments text-blue-500 text-xl"></i>
                                <span class="text-white">Forum Diskusi</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructor Dashboard -->
    <div id="instructorDashboard" class="hidden fixed inset-0 bg-gradient-to-br from-slate-900 to-slate-800 z-50 overflow-y-auto">
        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-white">Dashboard <span class="text-amber-400">Instruktur</span></h1>
                <button onclick="signOut()" class="px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition flex items-center gap-2">
                    <i class="fa-solid fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                <!-- Stats Cards -->
                <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-5 border border-slate-700 shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm font-medium">Total Siswa</p>
                            <p id="totalStudents" class="text-3xl font-bold text-amber-400">0</p>
                        </div>
                        <div class="bg-amber-500/10 p-3 rounded-lg">
                            <i class="fa-solid fa-users text-amber-400 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-5 border border-slate-700 shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm font-medium">Siswa Aktif</p>
                            <p id="activeStudents" class="text-3xl font-bold text-emerald-400">0</p>
                        </div>
                        <div class="bg-emerald-500/10 p-3 rounded-lg">
                            <i class="fa-solid fa-user-check text-emerald-400 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-5 border border-slate-700 shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm font-medium">Sesi Live</p>
                            <p id="liveSessions" class="text-3xl font-bold text-blue-400">0</p>
                        </div>
                        <div class="bg-blue-500/10 p-3 rounded-lg">
                            <i class="fa-solid fa-video text-blue-400 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-5 border border-slate-700 shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm font-medium">Kompleksi</p>
                            <p id="completionRate" class="text-3xl font-bold text-purple-400">0%</p>
                        </div>
                        <div class="bg-purple-500/10 p-3 rounded-lg">
                            <i class="fa-solid fa-chart-line text-purple-400 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Students List -->
                <div class="lg:col-span-2">
                    <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 shadow-xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-white flex items-center gap-2">
                                <i class="fa-solid fa-graduation-cap text-amber-400"></i> Daftar Siswa
                            </h2>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="studentSearch"
                                    placeholder="Cari siswa..."
                                    class="bg-slate-700 text-white rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-2 focus:ring-amber-500"
                                >
                                <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-slate-300">
                                <thead class="text-xs text-slate-400 uppercase border-b border-slate-700">
                                    <tr>
                                        <th scope="col" class="px-4 py-3">Nama</th>
                                        <th scope="col" class="px-4 py-3">Email</th>
                                        <th scope="col" class="px-4 py-3">Status</th>
                                        <th scope="col" class="px-4 py-3">Progress</th>
                                        <th scope="col" class="px-4 py-3">Pembayaran</th>
                                        <th scope="col" class="px-4 py-3">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <!-- Students will be populated here dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Instructor Profile & Actions -->
                <div>
                    <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 shadow-xl mb-8">
                        <div class="flex flex-col items-center text-center mb-6">
                            <div class="bg-gradient-to-br from-amber-700 to-orange-800 border-2 border-amber-500 rounded-full w-28 h-28 flex items-center justify-center text-white text-4xl mb-4">
                                <i class="fa-solid fa-chalkboard-user"></i>
                            </div>
                            <h2 id="instructorName" class="text-xl font-bold text-white"></h2>
                            <p id="instructorEmail" class="text-slate-400 mt-1 flex items-center gap-1">
                                <i class="fa-solid fa-envelope text-slate-500 text-sm mr-1"></i>
                                <span id="instructorEmailText"></span>
                            </p>
                        </div>

                        <div class="space-y-4">
                            <button class="w-full py-3 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-2">
                                <i class="fa-solid fa-plus"></i> Tambah Materi
                            </button>
                            <button onclick="openScheduleSessionModal()" class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-2">
                                <i class="fa-solid fa-calendar-check"></i> Jadwalkan Live Session
                            </button>
                            <button class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-2">
                                <i class="fa-solid fa-message"></i> Kirim Pengumuman
                            </button>
                        </div>
                    </div>

                    <!-- Session Management -->
                    <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 shadow-xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-white flex items-center gap-2">
                                <i class="fa-solid fa-calendar-alt text-amber-400"></i> Manajemen Sesi
                            </h2>
                            <button onclick="openScheduleSessionModal()" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 text-white text-sm rounded-lg transition flex items-center gap-1">
                                <i class="fa-solid fa-plus"></i> Tambah
                            </button>
                        </div>

                        <!-- Tab Navigation -->
                        <div class="flex border-b border-slate-600 mb-4">
                            <button class="tab-button px-4 py-2 font-medium text-slate-400 hover:text-white border-b-2 border-transparent hover:border-amber-500 transition" data-tab="upcoming">
                                Sesi Mendatang
                            </button>
                            <button class="tab-button px-4 py-2 font-medium text-slate-400 hover:text-white border-b-2 border-transparent hover:border-amber-500 transition" data-tab="past">
                                Sesi Terlaksana
                            </button>
                        </div>

                        <!-- Tab Content -->
                        <div id="upcomingSessionsTab" class="tab-content">
                            <div class="space-y-4" id="scheduledSessions">
                                <!-- Scheduled sessions will be populated here dynamically -->
                            </div>
                        </div>

                        <div id="pastSessionsTab" class="tab-content hidden">
                            <div class="space-y-4" id="pastSessions">
                                <!-- Past sessions will be populated here dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-slate-800/80 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 shadow-xl">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-bolt text-purple-400"></i> Aktivitas Terbaru
                        </h2>
                        <div class="space-y-4" id="recentActivity">
                            <!-- Activities will be populated here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Session Modal -->
    <div id="scheduleSessionModal" class="fixed inset-0 bg-black bg-opacity-70 hidden z-50 flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl max-w-2xl w-full mx-4 my-8 border border-slate-300">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-slate-800">Jadwalkan Sesi Baru</h3>
                    <button onclick="closeScheduleSessionModal()" class="text-slate-400 hover:text-slate-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="sessionForm">
                    <div class="mb-4">
                        <label for="sessionTitle" class="block text-slate-700 mb-2 font-medium">Judul Sesi</label>
                        <input
                            type="text"
                            id="sessionTitle"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            placeholder="Masukkan judul sesi"
                            required
                        >
                    </div>

                    <div class="mb-4">
                        <label for="sessionType" class="block text-slate-700 mb-2 font-medium">Tipe Sesi</label>
                        <select
                            id="sessionType"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            onchange="toggleLocationFields()"
                            required
                        >
                            <option value="">Pilih tipe sesi</option>
                            <option value="offline">Offline (Di Tempat Fisik)</option>
                            <option value="online">Online (Via Platform)</option>
                        </select>
                    </div>

                    <div id="locationFields" class="hidden">
                        <div class="mb-4">
                            <label for="sessionLocation" class="block text-slate-700 mb-2 font-medium">Lokasi</label>
                            <input
                                type="text"
                                id="sessionLocation"
                                class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                                placeholder="Alamat lengkap tempat sesi"
                            >
                        </div>
                    </div>

                    <div id="platformFields" class="hidden">
                        <div class="mb-4">
                            <label for="sessionPlatform" class="block text-slate-700 mb-2 font-medium">Platform Online</label>
                            <select
                                id="sessionPlatform"
                                class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            >
                                <option value="">Pilih platform</option>
                                <option value="zoom">Zoom</option>
                                <option value="gmeet">Google Meet</option>
                                <option value="teams">Microsoft Teams</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="sessionLink" class="block text-slate-700 mb-2 font-medium">Link Sesi</label>
                            <input
                                type="url"
                                id="sessionLink"
                                class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                                placeholder="https://meet.google.com/xxx-xxxx-xxx"
                            >
                        </div>

                        <div class="mb-4">
                            <label for="sessionPassword" class="block text-slate-700 mb-2 font-medium">Password (Opsional)</label>
                            <input
                                type="text"
                                id="sessionPassword"
                                class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                                placeholder="Password jika diperlukan"
                            >
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="sessionDate" class="block text-slate-700 mb-2 font-medium">Tanggal</label>
                            <input
                                type="date"
                                id="sessionDate"
                                class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                                required
                            >
                        </div>

                        <div>
                            <label for="sessionTime" class="block text-slate-700 mb-2 font-medium">Waktu</label>
                            <input
                                type="time"
                                id="sessionTime"
                                class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                                required
                            >
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="sessionDuration" class="block text-slate-700 mb-2 font-medium">Durasi (menit)</label>
                        <input
                            type="number"
                            id="sessionDuration"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition"
                            placeholder="Durasi dalam menit"
                            min="15"
                            value="60"
                            required
                        >
                    </div>

                    <div class="mb-6">
                        <label for="sessionDescription" class="block text-slate-700 mb-2 font-medium">Deskripsi</label>
                        <textarea
                            id="sessionDescription"
                            rows="3"
                            class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 text-slate-800 focus:ring-2 focus:ring-brand-500 focus:outline-none transition resize-none"
                            placeholder="Deskripsikan detail sesi..."
                        ></textarea>
                    </div>

                    <button
                        type="submit"
                        class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition"
                    >
                        <i class="fa-solid fa-calendar-plus mr-2"></i> Buat Jadwal Sesi
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Payment Validation Modal -->
    <div id="paymentValidationModal" class="fixed inset-0 bg-black bg-opacity-70 hidden z-50 flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl max-w-2xl w-full mx-4 my-8 border border-slate-300">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-slate-800">Validasi Pembayaran - <span id="validationStudentName"></span></h3>
                    <button onclick="closePaymentValidationModal()" class="text-slate-400 hover:text-slate-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold text-lg text-slate-700 mb-3">Detail Pembayaran</h4>
                    <div id="paymentDetailsContainer">
                        <!-- Payment details will be loaded here -->
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold text-lg text-slate-700 mb-3">Upload Bukti Transfer</h4>
                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-8 text-center cursor-pointer hover:bg-slate-50 transition" onclick="document.getElementById('proofUpload').click()">
                        <i class="fa-solid fa-cloud-arrow-up text-slate-400 text-4xl mb-3"></i>
                        <p class="text-slate-600">Klik untuk upload bukti transfer</p>
                        <p class="text-sm text-slate-500 mt-1">Format: JPG, PNG, PDF (Max 5MB)</p>
                        <input type="file" id="proofUpload" class="hidden" accept="image/*,.pdf">
                    </div>
                    <div id="uploadedProofPreview" class="mt-3 hidden">
                        <div class="flex items-center justify-between bg-slate-100 p-3 rounded-lg">
                            <div class="flex items-center">
                                <i class="fa-solid fa-file-image text-blue-500 mr-2"></i>
                                <span id="fileName" class="text-slate-700"></span>
                            </div>
                            <button type="button" onclick="removeProof()" class="text-red-500 hover:text-red-700">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button
                        onclick="updatePaymentStatus(currentValidatedStudentId, 'paid')"
                        class="py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition"
                    >
                        <i class="fa-solid fa-check mr-2"></i> Setujui
                    </button>
                    <button
                        onclick="updatePaymentStatus(currentValidatedStudentId, 'rejected')"
                        class="py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition"
                    >
                        <i class="fa-solid fa-times mr-2"></i> Tolak
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-950 py-12 border-t border-slate-900">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-2">
                <div class="bg-brand-700 text-white p-1 rounded font-bold text-lg">
                    <i class="fa-solid fa-code"></i>
                </div>
                <span class="font-bold text-xl tracking-tight text-white">SKT <span class="text-brand-500">Academy</span></span>
            </div>
            
            <div class="text-slate-500 text-sm">
                &copy; 2024 SKT Bootcamp Academy. All rights reserved.
            </div>

            <div class="flex gap-4 text-slate-400">
                <a href="#" class="hover:text-white transition"><i class="fa-brands fa-instagram text-xl"></i></a>
                <a href="#" class="hover:text-white transition"><i class="fa-brands fa-linkedin text-xl"></i></a>
                <a href="#" class="hover:text-white transition"><i class="fa-brands fa-github text-xl"></i></a>
            </div>
        </div>
    </footer>

    <!-- Gemini API Logic -->
    <script>
        const apiKey = "AIzaSyDgBUW5sshyKcsF-KV9p0FUuy4JMtZ-mmw"; // API Key will be injected by the environment

        async function analyzeProfile() {
            const userBackground = document.getElementById('user-background').value;
            const responseContainer = document.getElementById('ai-response');
            const loadingIndicator = document.getElementById('loading-indicator');
            const analyzeBtn = document.getElementById('analyze-btn');

            if (!userBackground.trim()) {
                responseContainer.innerHTML = '<p class="text-red-400">Mohon isi latar belakang Anda terlebih dahulu.</p>';
                return;
            }

            // UI Loading State
            loadingIndicator.classList.remove('hidden');
            analyzeBtn.disabled = true;
            analyzeBtn.classList.add('opacity-50', 'cursor-not-allowed');
            responseContainer.innerHTML = ''; // Clear previous

            const systemPrompt = `
                Anda adalah Konsultan Akademik Senior di SKT Bootcamp Academy.
                Bootcamp ini mengajarkan Fullstack Mobile dalam 12 minggu dengan kurikulum:
                - Fase 1 (Minggu 1-2): Docker Dasar & Express.js Dasar.
                - Fase 2 (Minggu 3-6): Advanced Express, Docker Compose, React Native Fundamentals.
                - Fase 3 (Minggu 7-9): Authentication (JWT), Integrasi API Mobile.
                - Fase 4 (Minggu 10-12): Production DevOps (Nginx, SSL), Build APK, Final Project.

                Tugas Anda:
                Analisa profil pengguna yang diberikan. Berikan jawaban yang menyemangati namun realistis.
                1. Apakah bootcamp ini cocok untuk mereka?
                2. Tantangan apa yang mungkin mereka hadapi berdasarkan background mereka?
                3. Sarankan fase mana yang harus mereka beri perhatian ekstra.
                
                Gunakan bahasa Indonesia yang ramah, profesional, dan gunakan formatting Markdown (bold, list) agar mudah dibaca.
                Tambahkan emoji yang relevan.
            `;

            const userPrompt = `Profil Pengguna: ${userBackground}`;

            try {
                const result = await callGeminiWithBackoff(systemPrompt, userPrompt);
                
                // Render Markdown using marked.js
                responseContainer.innerHTML = marked.parse(result);

            } catch (error) {
                console.error("Error:", error);
                responseContainer.innerHTML = `<p class="text-red-400">Maaf, terjadi kesalahan saat menghubungi AI Advisor. Silakan coba lagi nanti.<br><span class="text-xs opacity-70">${error.message}</span></p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                analyzeBtn.disabled = false;
                analyzeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        async function callGeminiWithBackoff(systemInstruction, userQuery) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            const maxRetries = 5;
            let attempt = 0;
            let delay = 1000;

            while (attempt < maxRetries) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                             throw new Error(`HTTP error! status: ${response.status}`);
                        }
                         const errorData = await response.json();
                         throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, tidak ada respon dari AI.";

                } catch (error) {
                    attempt++;
                    if (attempt >= maxRetries) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                }
            }
        }
        // Function to open the registration form modal
        function openRegistrationForm() {
            document.getElementById('registrationModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling when modal is open
        }

        // Function to close the registration form modal
        function closeRegistrationForm() {
            document.getElementById('registrationModal').classList.add('hidden');
            document.body.style.overflow = 'auto'; // Re-enable scrolling
        }

        // Handle form submission for non-logged-in users (original WhatsApp flow)
        document.getElementById('profileCompletionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;

            // Validate required fields
            if (!fullName || !email || !phone || !address) {
                alert('Mohon lengkapi semua informasi profil terlebih dahulu.');
                return;
            }

            // Create the WhatsApp message
            const message = `Halo! Saya ingin mendaftar bootcamp Fullstack Mobile.\n\nNama: ${fullName}\nEmail: ${email}\nWhatsApp: ${phone}\nAlamat: ${address}\n\nMohon info lebih lanjut.`;
            const phoneNumber = phone.replace(/^0/, '62'); // Convert Indonesian format (08xx) to international (628xx)
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

            // Open WhatsApp in a new tab
            window.open(whatsappUrl, '_blank');

            // Close the modal after sending
            closeRegistrationForm();

            // Reset the form to profile completion step
            document.getElementById('dpPaymentSection').classList.add('hidden');
            document.getElementById('submissionConfirmation').classList.add('hidden');
            document.getElementById('profileCompletion').classList.remove('hidden');
            document.getElementById('profileCompletionForm').reset();

            // Reset payment selection
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                btn.classList.remove('bg-emerald-500', 'text-white');
                btn.classList.add('bg-slate-200');
            });
            document.getElementById('selectedPaymentMethod').value = '';

            // Reset proof upload
            document.getElementById('proofUpload').value = '';
            document.getElementById('uploadedProofPreview').classList.add('hidden');
        });

        // Function to populate form with Google account data when user signs in
        function populateFormWithUserData(userData) {
            if (userData.displayName && !document.getElementById('fullName').value) {
                document.getElementById('fullName').value = userData.displayName;
            }
            if (userData.email && !document.getElementById('email').value) {
                document.getElementById('email').value = userData.email;
            }
        }

        // Function to handle form submission for logged-in users
        async function submitLoggedInUserForm() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            // Validate required fields
            if (!fullName || !email || !phone) {
                alert('Mohon lengkapi semua informasi pribadi terlebih dahulu.');
                return;
            }

            // Save user data to Firebase Realtime Database
            try {
                await saveUserDataToFirebase(fullName, email, phone);
                console.log('User data saved to Firebase successfully');

                // Move to payment step
                goToStep2();
            } catch (error) {
                console.error('Error saving user data to Firebase:', error);
                alert('Terjadi kesalahan saat menyimpan data. Silakan coba lagi.');
            }
        }

        // Function to save user data to Firebase Realtime Database
        async function saveUserDataToFirebase(fullName, email, phone, address) {
            // Get current user
            const user = auth.currentUser;

            if (!user) {
                throw new Error('User not authenticated');
            }

            // Create user data object
            const userData = {
                uid: user.uid,
                fullName: fullName,
                email: email,
                phone: phone,
                address: address || '', // Address is optional
                role: 'student', // Default role is student
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                lastLoginAt: firebase.database.ServerValue.TIMESTAMP
            };

            // Save to Firebase Realtime Database
            const userRef = database.ref('users/' + user.uid);
            await userRef.set(userData);

            // Also save to a separate students list for easier querying
            const studentsRef = database.ref('students/' + user.uid);
            await studentsRef.set({
                uid: user.uid,
                fullName: fullName,
                email: email,
                phone: phone,
                address: address || '',
                enrolledAt: firebase.database.ServerValue.TIMESTAMP
            });

            return userData;
        }

        // Function to update user role (for admin/instructor promotion)
        async function updateUserRole(userId, newRole) {
            const userRef = database.ref('users/' + userId);
            await userRef.update({
                role: newRole
            });
        }

        // Function to create payment plan for a student
        async function createPaymentPlan(studentId, studentName, studentEmail) {
            // Total course fee: 5,000,000
            const totalFee = 5000000;
            const downPaymentPercentage = 20;
            const downPaymentAmount = totalFee * (downPaymentPercentage / 100); // 1,000,000
            const remainingAmount = totalFee - downPaymentAmount; // 4,000,000
            const monthlyInstallment = 1000000; // 4 months
            const numberOfInstallments = remainingAmount / monthlyInstallment; // 4

            // Create payment plan object
            const paymentPlan = {
                totalFee: totalFee,
                downPayment: {
                    amount: downPaymentAmount,
                    dueDate: new Date().toISOString().split('T')[0], // Today
                    status: 'pending', // pending, paid, overdue
                    paidAt: null
                },
                installments: [],
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            };

            // Generate installment schedule
            const today = new Date();
            for (let i = 0; i < numberOfInstallments; i++) {
                const installmentDate = new Date(today);
                installmentDate.setMonth(today.getMonth() + i + 1); // Next month for first installment

                paymentPlan.installments.push({
                    id: `installment_${i+1}`,
                    amount: monthlyInstallment,
                    dueDate: installmentDate.toISOString().split('T')[0],
                    status: 'pending',
                    paidAt: null
                });
            }

            // Save payment plan to database
            const paymentPlanRef = database.ref(`payment_plans/${studentId}`);
            await paymentPlanRef.set(paymentPlan);

            // Also save to student's record
            const studentRef = database.ref(`students/${studentId}`);
            await studentRef.update({
                paymentPlanId: studentId,
                paymentStatus: 'pending' // pending, paid, partially_paid
            });

            // Create payment history entry
            await addPaymentHistory(studentId, 'created', 'Payment plan created', totalFee, studentName, studentEmail);

            return paymentPlan;
        }

        // Function to record a payment
        async function recordPayment(studentId, paymentType, amount, transactionId = null) {
            const paymentPlanRef = database.ref(`payment_plans/${studentId}`);
            const paymentPlanSnapshot = await paymentPlanRef.once('value');
            const paymentPlan = paymentPlanSnapshot.val();

            if (!paymentPlan) {
                throw new Error('Payment plan not found');
            }

            let updatedPlan = {...paymentPlan};
            const now = new Date();

            if (paymentType.startsWith('installment_')) {
                // Update specific installment
                const installmentIndex = updatedPlan.installments.findIndex(inst => inst.id === paymentType);
                if (installmentIndex !== -1) {
                    updatedPlan.installments[installmentIndex].status = 'paid';
                    updatedPlan.installments[installmentIndex].paidAt = now.toISOString();
                }
            } else if (paymentType === 'down_payment') {
                // Update down payment
                updatedPlan.downPayment.status = 'paid';
                updatedPlan.downPayment.paidAt = now.toISOString();
            }

            // Update payment plan in database
            await paymentPlanRef.update(updatedPlan);

            // Update student's payment status
            const studentRef = database.ref(`students/${studentId}`);
            const studentSnapshot = await studentRef.once('value');
            const studentData = studentSnapshot.val();

            // Determine overall payment status
            let overallStatus = 'pending';
            const allPaid = updatedPlan.downPayment.status === 'paid' &&
                           updatedPlan.installments.every(inst => inst.status === 'paid');
            const somePaid = updatedPlan.downPayment.status === 'paid' ||
                           updatedPlan.installments.some(inst => inst.status === 'paid');

            if (allPaid) {
                overallStatus = 'paid';
            } else if (somePaid) {
                overallStatus = 'partially_paid';
            }

            await studentRef.update({
                paymentStatus: overallStatus
            });

            // Add to payment history
            await addPaymentHistory(studentId, paymentType, 'Payment recorded', amount, studentData.fullName, studentData.email, transactionId);

            return updatedPlan;
        }

        // Function to add payment history
        async function addPaymentHistory(studentId, paymentType, description, amount, studentName, studentEmail, transactionId = null) {
            const historyEntry = {
                studentId,
                studentName,
                studentEmail,
                paymentType,
                description,
                amount,
                transactionId,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Add to payment history
            const historyRef = database.ref('payment_history');
            await historyRef.push(historyEntry);
        }

        // Function to get student's payment plan
        async function getStudentPaymentPlan(studentId) {
            const paymentPlanRef = database.ref(`payment_plans/${studentId}`);
            const snapshot = await paymentPlanRef.once('value');
            return snapshot.val();
        }

        // Function to open schedule session modal
        function openScheduleSessionModal() {
            document.getElementById('scheduleSessionModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Function to close schedule session modal
        function closeScheduleSessionModal() {
            document.getElementById('scheduleSessionModal').classList.add('hidden');
            document.body.style.overflow = 'auto';

            // Reset form
            document.getElementById('sessionForm').reset();
            document.getElementById('locationFields').classList.add('hidden');
            document.getElementById('platformFields').classList.add('hidden');
        }

        // Function to toggle location and platform fields based on session type
        function toggleLocationFields() {
            const sessionType = document.getElementById('sessionType').value;
            const locationFields = document.getElementById('locationFields');
            const platformFields = document.getElementById('platformFields');

            if (sessionType === 'offline') {
                locationFields.classList.remove('hidden');
                platformFields.classList.add('hidden');
            } else if (sessionType === 'online') {
                locationFields.classList.add('hidden');
                platformFields.classList.remove('hidden');
            } else {
                locationFields.classList.add('hidden');
                platformFields.classList.add('hidden');
            }
        }

        // Function to save session to Firebase
        async function saveSessionToFirebase(sessionData) {
            // Get current instructor
            const user = auth.currentUser;

            if (!user) {
                throw new Error('User not authenticated');
            }

            // Add instructor ID to session data
            sessionData.instructorId = user.uid;
            sessionData.createdAt = firebase.database.ServerValue.TIMESTAMP;

            // Generate unique session ID
            const sessionId = database.ref().child('sessions').push().key;

            // Save to Firebase Realtime Database
            const sessionRef = database.ref('sessions/' + sessionId);
            await sessionRef.set(sessionData);

            // Also save to instructor's sessions
            const instructorSessionRef = database.ref(`instructors/${user.uid}/sessions/${sessionId}`);
            await instructorSessionRef.set(sessionData);

            return sessionId;
        }

        // Function to format date for display
        function formatDate(dateString, timeString) {
            const date = new Date(`${dateString}T${timeString}`);
            return date.toLocaleString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Function to format duration
        function formatDuration(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            if (hours > 0) {
                return `${hours} jam ${mins} menit`;
            }
            return `${mins} menit`;
        }

        // Function to load scheduled sessions for instructor
        async function loadScheduledSessions(instructorUid) {
            try {
                // Get instructor's sessions
                const sessionsSnapshot = await database.ref(`instructors/${instructorUid}/sessions`).orderByChild('date').once('value');
                const sessions = sessionsSnapshot.val() || {};

                // Convert to array and sort by date/time
                const sessionArray = [];
                for (const [id, session] of Object.entries(sessions)) {
                    sessionArray.push({ id, ...session });
                }

                // Sort by date and time (ascending)
                sessionArray.sort((a, b) => {
                    const dateA = new Date(`${a.date}T${a.time}`);
                    const dateB = new Date(`${b.date}T${b.time}`);
                    return dateA - dateB;
                });

                // Filter upcoming and past sessions
                const now = new Date();
                const upcomingSessions = sessionArray.filter(session => {
                    const sessionDateTime = new Date(`${session.date}T${session.time}`);
                    return sessionDateTime >= now; // Only show future sessions
                });

                const pastSessions = sessionArray.filter(session => {
                    const sessionDateTime = new Date(`${session.date}T${session.time}`);
                    return sessionDateTime < now; // Only show past sessions
                }).reverse(); // Reverse to show most recent first

                // Load upcoming sessions
                loadUpcomingSessions(upcomingSessions);

                // Load past sessions
                loadPastSessions(pastSessions);

                // Add event listeners to tab buttons
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', function() {
                        const tabName = this.getAttribute('data-tab');

                        // Remove active classes
                        document.querySelectorAll('.tab-button').forEach(btn => {
                            btn.classList.remove('text-white', 'border-amber-500');
                            btn.classList.add('text-slate-400');
                        });

                        // Add active classes to clicked button
                        this.classList.remove('text-slate-400');
                        this.classList.add('text-white', 'border-amber-500');

                        // Hide all tab content
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.add('hidden');
                        });

                        // Show selected tab content
                        document.getElementById(`${tabName}SessionsTab`).classList.remove('hidden');
                    });
                });

                // Set default to upcoming sessions tab
                document.querySelector('[data-tab="upcoming"]').classList.add('text-white', 'border-amber-500');
                document.getElementById('upcomingSessionsTab').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading scheduled sessions:', error);
                document.getElementById('scheduledSessions').innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-red-400">Gagal memuat jadwal sesi</p>
                    </div>
                `;
            }
        }

        // Function to load upcoming sessions
        function loadUpcomingSessions(sessions) {
            const scheduledSessionsContainer = document.getElementById('scheduledSessions');

            // Clear current sessions
            scheduledSessionsContainer.innerHTML = '';

            if (sessions.length === 0) {
                scheduledSessionsContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fa-solid fa-calendar-day text-slate-500 text-3xl mb-2"></i>
                        <p class="text-slate-400">Belum ada sesi yang dijadwalkan</p>
                        <button onclick="openScheduleSessionModal()" class="mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition">
                            Jadwalkan Sesi
                        </button>
                    </div>
                `;
                return;
            }

            // Add each session to the container
            sessions.forEach(session => {
                const sessionElement = document.createElement('div');
                sessionElement.className = 'bg-slate-700 rounded-lg p-4 border border-slate-600';

                // Format the date and time
                const formattedDateTime = formatDate(session.date, session.time);
                const formattedDuration = formatDuration(session.duration);

                // Determine icon and color based on session type
                let typeIcon, typeColor, typeText;
                if (session.type === 'offline') {
                    typeIcon = 'fa-building';
                    typeColor = 'bg-blue-500/10 text-blue-400';
                    typeText = 'Offline';
                } else {
                    typeIcon = 'fa-video';
                    typeColor = 'bg-purple-500/10 text-purple-400';
                    typeText = 'Online';
                }

                sessionElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="font-bold text-white">${session.title}</h3>
                                <span class="px-2 py-1 text-xs rounded-full ${typeColor}">
                                    <i class="fa-solid ${typeIcon}"></i> ${typeText}
                                </span>
                            </div>
                            <p class="text-slate-400 text-sm mb-2">${formattedDateTime} â€¢ ${formattedDuration}</p>

                            ${session.type === 'offline' ?
                                `<div class="flex items-center gap-2 text-sm text-slate-300">
                                    <i class="fa-solid fa-location-dot text-slate-500"></i>
                                    <span>${session.location || 'Lokasi belum ditentukan'}</span>
                                </div>` :
                                `<div class="flex items-center gap-2 text-sm text-slate-300">
                                    <i class="fa-solid fa-link text-slate-500"></i>
                                    <a href="${session.link || '#'}" target="_blank" class="text-brand-400 hover:underline">${session.platform || 'Platform belum ditentukan'}</a>
                                </div>`
                            }

                            <p class="text-slate-400 text-sm mt-2 line-clamp-2">${session.description || 'Tidak ada deskripsi'}</p>
                        </div>
                        <div class="flex gap-2">
                            <button class="p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-600">
                                <i class="fa-solid fa-edit"></i>
                            </button>
                            <button class="p-2 text-slate-400 hover:text-red-400 rounded-lg hover:bg-slate-600" onclick="deleteSession('${session.id}')">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;

                scheduledSessionsContainer.appendChild(sessionElement);
            });
        }

        // Function to load past sessions
        function loadPastSessions(sessions) {
            const pastSessionsContainer = document.getElementById('pastSessions');

            // Clear current sessions
            pastSessionsContainer.innerHTML = '';

            if (sessions.length === 0) {
                pastSessionsContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fa-solid fa-calendar-check text-slate-500 text-3xl mb-2"></i>
                        <p class="text-slate-400">Belum ada sesi yang terlaksana</p>
                    </div>
                `;
                return;
            }

            // Add each session to the container
            sessions.forEach(session => {
                const sessionElement = document.createElement('div');
                sessionElement.className = 'bg-slate-700 rounded-lg p-4 border border-slate-600';

                // Format the date and time
                const formattedDateTime = formatDate(session.date, session.time);
                const formattedDuration = formatDuration(session.duration);

                // Determine icon and color based on session type
                let typeIcon, typeColor, typeText;
                if (session.type === 'offline') {
                    typeIcon = 'fa-building';
                    typeColor = 'bg-blue-500/10 text-blue-400';
                    typeText = 'Offline';
                } else {
                    typeIcon = 'fa-video';
                    typeColor = 'bg-purple-500/10 text-purple-400';
                    typeText = 'Online';
                }

                sessionElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="font-bold text-white">${session.title}</h3>
                                <span class="px-2 py-1 text-xs rounded-full ${typeColor}">
                                    <i class="fa-solid ${typeIcon}"></i> ${typeText}
                                </span>
                            </div>
                            <p class="text-slate-400 text-sm mb-2">${formattedDateTime} â€¢ ${formattedDuration}</p>

                            ${session.type === 'offline' ?
                                `<div class="flex items-center gap-2 text-sm text-slate-300">
                                    <i class="fa-solid fa-location-dot text-slate-500"></i>
                                    <span>${session.location || 'Lokasi belum ditentukan'}</span>
                                </div>` :
                                `<div class="flex items-center gap-2 text-sm text-slate-300">
                                    <i class="fa-solid fa-link text-slate-500"></i>
                                    <a href="${session.link || '#'}" target="_blank" class="text-brand-400 hover:underline">${session.platform || 'Platform belum ditentukan'}</a>
                                </div>`
                            }

                            <p class="text-slate-400 text-sm mt-2 line-clamp-2">${session.description || 'Tidak ada deskripsi'}</p>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400">
                                <i class="fa-solid fa-check"></i> Terlaksana
                            </span>
                        </div>
                    </div>
                `;

                pastSessionsContainer.appendChild(sessionElement);
            });
        }

        // Function to delete a session
        async function deleteSession(sessionId) {
            if (!confirm('Apakah Anda yakin ingin menghapus sesi ini?')) {
                return;
            }

            try {
                // Get current instructor
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }

                // Remove from both locations in the database
                await database.ref(`sessions/${sessionId}`).remove();
                await database.ref(`instructors/${user.uid}/sessions/${sessionId}`).remove();

                // Refresh the scheduled sessions list
                await loadScheduledSessions(user.uid);

                alert('Sesi berhasil dihapus');
            } catch (error) {
                console.error('Error deleting session:', error);
                alert('Terjadi kesalahan saat menghapus sesi. Silakan coba lagi.');
            }
        }

        // Variable to store current validated student ID
        let currentValidatedStudentId = null;

        // Function to open payment validation modal
        async function openPaymentValidationModal(studentId, studentName) {
            currentValidatedStudentId = studentId;
            document.getElementById('validationStudentName').textContent = studentName;

            // Load payment details for this student
            await loadPaymentDetailsForValidation(studentId);

            document.getElementById('paymentValidationModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Function to close payment validation modal
        function closePaymentValidationModal() {
            document.getElementById('paymentValidationModal').classList.add('hidden');
            document.body.style.overflow = 'auto';

            // Reset uploaded proof preview
            document.getElementById('uploadedProofPreview').classList.add('hidden');
            document.getElementById('proofUpload').value = '';
        }

        // Function to load payment details for validation
        async function loadPaymentDetailsForValidation(studentId) {
            try {
                const paymentPlan = await getStudentPaymentPlan(studentId);

                if (!paymentPlan) {
                    document.getElementById('paymentDetailsContainer').innerHTML = `
                        <div class="text-center py-4 text-slate-500">
                            <i class="fa-solid fa-exclamation-triangle text-2xl mb-2"></i>
                            <p>Data pembayaran tidak ditemukan</p>
                        </div>
                    `;
                    return;
                }

                // Calculate payment status
                const dpPaid = paymentPlan.downPayment.status === 'paid';
                const installmentsPaid = paymentPlan.installments.filter(inst => inst.status === 'paid').length;
                const totalInstallments = paymentPlan.installments.length;

                // Format the payment details
                let detailsHTML = `
                    <div class="bg-slate-100 p-4 rounded-lg mb-4">
                        <div class="grid grid-cols-2 gap-4 mb-3">
                            <div>
                                <p class="text-slate-600 text-sm">Total Biaya</p>
                                <p class="font-bold">Rp ${paymentPlan.totalFee.toLocaleString('id-ID')}</p>
                            </div>
                            <div>
                                <p class="text-slate-600 text-sm">Status Keseluruhan</p>
                                <p class="font-bold ${
                                    dpPaid && installmentsPaid === totalInstallments ? 'text-green-600' :
                                    dpPaid || installmentsPaid > 0 ? 'text-yellow-600' : 'text-red-600'
                                }">
                                    ${dpPaid && installmentsPaid === totalInstallments ? 'Lunas' :
                                      dpPaid || installmentsPaid > 0 ? 'Sebagian Dibayar' : 'Belum Dibayar'}
                                </p>
                            </div>
                        </div>

                        <div class="border-t border-slate-200 pt-3">
                            <h5 class="font-semibold mb-2">Rincian Pembayaran:</h5>

                            <div class="mb-3">
                                <div class="flex justify-between items-center">
                                    <span>Down Payment (20%)</span>
                                    <span class="font-medium">Rp ${paymentPlan.downPayment.amount.toLocaleString('id-ID')}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Jatuh Tempo: ${paymentPlan.downPayment.dueDate}</span>
                                    <span class="${
                                        dpPaid ? 'text-green-600' : 'text-red-600'
                                    }">${dpPaid ? 'Dibayar' : 'Belum Dibayar'}</span>
                                </div>
                            </div>

                            <div>
                                <div class="flex justify-between items-center">
                                    <span>Cicilan Bulanan (${totalInstallments} x)</span>
                                    <span class="font-medium">Rp ${paymentPlan.installments[0]?.amount.toLocaleString('id-ID') || '0'}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Dibayar: ${installmentsPaid}/${totalInstallments}</span>
                                    <span class="${
                                        installmentsPaid === totalInstallments ? 'text-green-600' :
                                        installmentsPaid > 0 ? 'text-yellow-600' : 'text-red-600'
                                    }">
                                        ${installmentsPaid === totalInstallments ? 'Lunas' :
                                         installmentsPaid > 0 ? 'Sebagian' : 'Belum Dibayar'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('paymentDetailsContainer').innerHTML = detailsHTML;
            } catch (error) {
                console.error('Error loading payment details:', error);
                document.getElementById('paymentDetailsContainer').innerHTML = `
                    <div class="text-center py-4 text-red-500">
                        <i class="fa-solid fa-exclamation-circle text-2xl mb-2"></i>
                        <p>Error memuat data pembayaran</p>
                    </div>
                `;
            }
        }

        // Function to update payment status
        async function updatePaymentStatus(studentId, status) {
            try {
                // Get current instructor
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }

                // Get the student's payment plan
                const paymentPlan = await getStudentPaymentPlan(studentId);

                if (!paymentPlan) {
                    throw new Error('Payment plan not found');
                }

                // Update the specific payment item (down payment in this case)
                const updatedPlan = { ...paymentPlan };
                if (status === 'paid') {
                    updatedPlan.downPayment.status = 'paid';
                    updatedPlan.downPayment.paidAt = new Date().toISOString();
                } else {
                    updatedPlan.downPayment.status = 'rejected';
                    updatedPlan.downPayment.rejectedAt = new Date().toISOString();
                }

                // Update the payment plan in the database
                const paymentPlanRef = database.ref(`payment_plans/${studentId}`);
                await paymentPlanRef.update(updatedPlan);

                // Update student's overall payment status
                const studentRef = database.ref(`students/${studentId}`);
                await studentRef.update({
                    paymentStatus: status === 'paid' ? 'paid_dp' : 'pending_dp',
                    lastUpdatedBy: user.uid,
                    lastUpdated: firebase.database.ServerValue.TIMESTAMP
                });

                // Close modal and refresh instructor dashboard
                closePaymentValidationModal();

                // Refresh the instructor dashboard to reflect changes
                if (auth.currentUser) {
                    await loadInstructorDashboardData(auth.currentUser.uid);
                }

                alert(status === 'paid' ? 'Pembayaran DP berhasil disetujui! Mahasiswa sekarang dapat mengakses fitur pembayaran dan jadwal.' : 'Pembayaran DP ditolak. Mahasiswa perlu mengirim ulang bukti pembayaran.');
            } catch (error) {
                console.error('Error updating payment status:', error);
                alert('Terjadi kesalahan saat memperbarui status pembayaran. Silakan coba lagi.');
            }
        }

        // Event listener for file upload
        document.getElementById('proofUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('uploadedProofPreview').classList.remove('hidden');
            }
        });

        // Function to remove uploaded proof
        function removeProof() {
            document.getElementById('proofUpload').value = '';
            document.getElementById('uploadedProofPreview').classList.add('hidden');
        }

        // Close payment validation modal when clicking outside of it
        document.getElementById('paymentValidationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePaymentValidationModal();
            }
        });

        // Handle session form submission
        document.getElementById('sessionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const sessionTitle = document.getElementById('sessionTitle').value;
            const sessionType = document.getElementById('sessionType').value;
            const sessionDate = document.getElementById('sessionDate').value;
            const sessionTime = document.getElementById('sessionTime').value;
            const sessionDuration = parseInt(document.getElementById('sessionDuration').value);
            const sessionDescription = document.getElementById('sessionDescription').value;

            // Prepare session data based on type
            let sessionData = {
                title: sessionTitle,
                type: sessionType,
                date: sessionDate,
                time: sessionTime,
                duration: sessionDuration,
                description: sessionDescription,
                status: 'scheduled'
            };

            // Add type-specific fields
            if (sessionType === 'offline') {
                sessionData.location = document.getElementById('sessionLocation').value;
            } else if (sessionType === 'online') {
                sessionData.platform = document.getElementById('sessionPlatform').value;
                sessionData.link = document.getElementById('sessionLink').value;
                sessionData.password = document.getElementById('sessionPassword').value;
            }

            try {
                // Save session to Firebase
                await saveSessionToFirebase(sessionData);

                // Show success message
                alert('Jadwal sesi berhasil dibuat!');

                // Close modal
                closeScheduleSessionModal();

                // Refresh instructor dashboard to show new session
                if (typeof loadInstructorDashboardData !== 'undefined' && auth.currentUser) {
                    await loadInstructorDashboardData(auth.currentUser.uid);
                }
            } catch (error) {
                console.error('Error saving session:', error);
                alert('Terjadi kesalahan saat membuat jadwal sesi. Silakan coba lagi.');
            }
        });

        // Close modal when clicking outside of it
        document.getElementById('scheduleSessionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeScheduleSessionModal();
            }
        });

        // Countdown Timer Functionality
        function initializeCountdown() {
            // Set the target date to 14 days from now
            const startDate = localStorage.getItem('countdownStart');
            let targetDate;

            if (startDate) {
                targetDate = new Date(startDate);
            } else {
                targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + 14);
                localStorage.setItem('countdownStart', targetDate.toISOString());
            }

            const timerInterval = setInterval(function() {
                const now = new Date().getTime();
                const distance = targetDate.getTime() - now;

                // Calculate days, hours, minutes, seconds
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Display the result
                document.querySelector('#countdownTimer div:nth-child(1) span:first-child').innerHTML = days;
                document.querySelector('#countdownTimer div:nth-child(3) span:first-child').innerHTML = hours;
                document.querySelector('#countdownTimer div:nth-child(5) span:first-child').innerHTML = minutes;
                document.querySelector('#countdownTimer div:nth-child(7) span:first-child').innerHTML = seconds;

                // If the countdown is finished
                if (distance < 0) {
                    clearInterval(timerInterval);
                    document.getElementById('countdownTimer').innerHTML = "<p class='text-red-600 font-bold'>Penawaran telah berakhir!</p>";
                }
            }, 1000);
        }

        // Function to reset the timer
        function resetCountdown() {
            localStorage.removeItem('countdownStart');
            // Reload the page to restart the timer
            location.reload();
        }

        // Initialize the countdown when the page loads
        document.addEventListener('DOMContentLoaded', initializeCountdown);

        // Close modal when clicking outside of it
        document.getElementById('registrationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeRegistrationForm();
            }
        });

        // Function to handle profile completion form submission
        document.getElementById('profileCompletionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;

            // Validate required fields
            if (!fullName || !email || !phone || !address) {
                alert('Mohon lengkapi semua informasi profil terlebih dahulu.');
                return;
            }

            // Check if user is logged in
            const user = auth.currentUser;
            if (user) {
                // For logged-in users, save data to Firebase first
                try {
                    await saveUserDataToFirebase(fullName, email, phone, address);
                    console.log('User data saved to Firebase successfully');

                    // Move to DP payment step
                    goToDPaymentStep();
                } catch (error) {
                    console.error('Error saving user data to Firebase:', error);
                    alert('Terjadi kesalahan saat menyimpan data. Silakan coba lagi.');
                }
            } else {
                alert('Silakan login terlebih dahulu menggunakan akun Google Anda.');
            }
        });

        // Function to navigate to DP payment step
        function goToDPaymentStep() {
            document.getElementById('profileCompletion').classList.add('hidden');
            document.getElementById('dpPaymentSection').classList.remove('hidden');
        }

        // Function to navigate back to profile step
        function goToProfileStep() {
            document.getElementById('dpPaymentSection').classList.add('hidden');
            document.getElementById('profileCompletion').classList.remove('hidden');
        }

        // Function to submit DP payment
        function submitDPayment() {
            const selectedMethod = document.getElementById('selectedPaymentMethod').value;
            const proofFile = document.getElementById('proofUpload').files[0];

            if (!selectedMethod) {
                alert('Silakan pilih metode pembayaran terlebih dahulu.');
                return;
            }

            if (!proofFile) {
                alert('Silakan upload bukti transfer DP terlebih dahulu.');
                return;
            }

            // In a real application, this would upload the proof and process the payment
            // For now, we'll just simulate the process and move to confirmation
            setTimeout(() => {
                // Hide payment step and show confirmation
                document.getElementById('dpPaymentSection').classList.add('hidden');
                document.getElementById('submissionConfirmation').classList.remove('hidden');
            }, 500);
        }

        // Function to finish profile setup
        function finishProfileSetup() {
            // Close the modal
            closeRegistrationForm();

            // Reset the form to profile completion step
            document.getElementById('dpPaymentSection').classList.add('hidden');
            document.getElementById('submissionConfirmation').classList.add('hidden');
            document.getElementById('profileCompletion').classList.remove('hidden');

            // Reset form fields
            document.getElementById('profileCompletionForm').reset();

            // Reset payment selection
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                btn.classList.remove('bg-emerald-500', 'text-white');
                btn.classList.add('bg-slate-200');
            });
            document.getElementById('selectedPaymentMethod').value = '';

            // Reset proof upload
            document.getElementById('proofUpload').value = '';
            document.getElementById('uploadedProofPreview').classList.add('hidden');
        }

        // Function to select payment method
        document.querySelectorAll('.payment-method-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.payment-method-btn').forEach(btn => {
                    btn.classList.remove('bg-emerald-500', 'text-white');
                    btn.classList.add('bg-slate-200');
                });

                // Add active class to clicked button
                this.classList.add('bg-emerald-500', 'text-white');
                this.classList.remove('bg-slate-200');

                // Store selected payment method
                const method = this.getAttribute('data-method');
                document.getElementById('selectedPaymentMethod').value = method;
            });
        });

        // Event listener for file upload
        document.getElementById('proofUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('uploadedProofPreview').classList.remove('hidden');
            }
        });

        // Function to remove uploaded proof
        function removeProof() {
            document.getElementById('proofUpload').value = '';
            document.getElementById('uploadedProofPreview').classList.add('hidden');
        }


        // Initialize Firebase
        // TODO: Replace with your actual Firebase project configuration
        // Follow these steps to get your config:
        // 1. Go to https://console.firebase.google.com/
        // 2. Create a new project or select existing one
        // 3. Add a web app to your project
        // 4. Copy the config object from the setup instructions
        const firebaseConfig = {
  apiKey: "AIzaSyA7OXByNsv-TSx02V89XCiqrPF25q7H2PU",
  authDomain: "e-landing.firebaseapp.com",
  databaseURL: "https://e-landing-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "e-landing",
  storageBucket: "e-landing.firebasestorage.app",
  messagingSenderId: "639561118309",
  appId: "1:639561118309:web:1c8bd83499d97369448c8c",
  measurementId: "G-D223D9PRFH"
};

        // Initialize Firebase app if not already initialized
        let app;
        try {
            app = firebase.initializeApp(firebaseConfig);
        } catch (error) {
            // If app is already initialized, get the existing app
            app = firebase.app();
        }

        // Initialize Firebase auth and database
        const auth = firebase.auth();
        const database = firebase.database();

        /*
         * IMPORTANT: To enable Google authentication, follow these steps in Firebase Console:
         * 1. Go to Firebase Console -> Authentication -> Sign-in method
         * 2. Enable "Google" sign-in provider
         * 3. Add your domain to "Authorized domains" (e.g., "localhost" for local development)
         * 4. Save the changes
         *
         * For Realtime Database:
         * 1. Go to Firebase Console -> Realtime Database
         * 2. Create a database (start in test mode for development)
         * 3. Set up rules to allow read/write as needed
         *
         * Common Issues:
         * - Make sure your authDomain matches your Firebase project domain
         * - Ensure "Authorized domains" includes your current domain
         * - Check that Google sign-in provider is enabled
         * - Verify your Firebase project is properly configured
         */

        // Function to handle Google sign-in
        async function signInWithGoogle() {
            // Check if Firebase is properly initialized
            if (!firebase.apps.length) {
                alert('Firebase belum diinisialisasi. Pastikan Anda telah mengatur konfigurasi Firebase dengan benar.');
                return;
            }

            try {
                const provider = new firebase.auth.GoogleAuthProvider();

                // Add scopes if needed
                provider.addScope('profile');
                provider.addScope('email');

                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                // Update UI after successful login
                updateUIAfterLogin(user);

                // Optionally store user data in localStorage or send to your backend
                localStorage.setItem('firebaseUser', JSON.stringify({
                    uid: user.uid,
                    displayName: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL
                }));

                console.log('User signed in:', user);
                return user;
            } catch (error) {
                console.error('Error during Google sign-in:', error);

                // Provide more specific error messages
                let errorMessage = 'Terjadi kesalahan saat login dengan Google.';

                switch(error.code) {
                    case 'auth/popup-blocked':
                        errorMessage = 'Popup login diblokir oleh browser. Mohon izinkan popup untuk situs ini.';
                        break;
                    case 'auth/cancelled-popup-request':
                        errorMessage = 'Permintaan login dibatalkan.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Kesalahan jaringan. Pastikan Anda terhubung ke internet.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Login dengan Google belum diaktifkan. Hubungi administrator.';
                        break;
                    case 'auth/unauthorized-domain':
                        errorMessage = 'Domain ini tidak diotorisasi. Tambahkan domain ini ke Firebase Console.';
                        break;
                    default:
                        errorMessage += ' (' + error.message + ')';
                }

                alert(errorMessage);
            }
        }

        // Function to handle sign out
        async function signOut() {
            try {
                await auth.signOut();
                // Update UI after logout
                updateUIAfterLogout();
                localStorage.removeItem('firebaseUser');
                console.log('User signed out');
            } catch (error) {
                console.error('Error during sign out:', error);
            }
        }

        // Function to update UI after login
        function updateUIAfterLogin(user) {
            // Hide the Google login button
            const googleLoginButton = document.getElementById('google-login-btn');
            if (googleLoginButton) {
                googleLoginButton.style.display = 'none';
            }

            // Show user info and logout button
            const userInfoDiv = document.getElementById('user-info');
            if (userInfoDiv) {
                userInfoDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        ${user.photoURL ? `<img src="${user.photoURL}" alt="Profile" class="w-10 h-10 rounded-full">` : ''}
                        <div>
                            <p class="font-medium">${user.displayName || user.email}</p>
                            <p class="text-sm text-slate-500">${user.email}</p>
                        </div>
                    </div>
                    <button onclick="signOut()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                        Logout
                    </button>
                `;
                userInfoDiv.style.display = 'flex';
                userInfoDiv.classList.add('justify-between', 'items-center');
            }

            // Pre-populate registration form fields if user is logged in
            populateFormWithUserData({
                displayName: user.displayName,
                email: user.email
            });
        }

        // Function to update UI after logout
        function updateUIAfterLogout() {
            // Show the Google login button again
            const googleLoginButton = document.getElementById('google-login-btn');
            if (googleLoginButton) {
                googleLoginButton.style.display = 'block';
            }

            // Hide user info
            const userInfoDiv = document.getElementById('user-info');
            if (userInfoDiv) {
                userInfoDiv.style.display = 'none';
                userInfoDiv.innerHTML = '';
            }

            // Hide student dashboard and show main content
            document.getElementById('studentDashboard').classList.add('hidden');
            document.getElementById('instructorDashboard').classList.add('hidden');
            document.querySelectorAll('.hidden-on-login').forEach(el => {
                el.classList.remove('hidden');
            });

            // Show registration button and hide user panel
            document.getElementById('registerButton').classList.remove('hidden');
            document.getElementById('userPanel').classList.add('hidden');

            // Hide dashboard and logout buttons
            const dashboardButton = document.getElementById('dashboardButton');
            const logoutButton = document.getElementById('logoutButton');

            if (dashboardButton) {
                dashboardButton.classList.add('hidden');
            }

            if (logoutButton) {
                logoutButton.classList.add('hidden');
            }
        }

        // Function to update UI after login
        function updateUIAfterLogin(user) {
            // Hide the Google login button
            const googleLoginButton = document.getElementById('google-login-btn');
            if (googleLoginButton) {
                googleLoginButton.style.display = 'none';
            }

            // Show user info and logout button
            const userInfoDiv = document.getElementById('user-info');
            if (userInfoDiv) {
                userInfoDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        ${user.photoURL ? `<img src="${user.photoURL}" alt="Profile" class="w-10 h-10 rounded-full">` : ''}
                        <div>
                            <p class="font-medium">${user.displayName || user.email}</p>
                            <p class="text-sm text-slate-500">${user.email}</p>
                        </div>
                    </div>
                    <button onclick="signOut()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                        Logout
                    </button>
                `;
                userInfoDiv.style.display = 'flex';
                userInfoDiv.classList.add('justify-between', 'items-center');
            }

            // Pre-populate registration form fields if user is logged in
            populateFormWithUserData({
                displayName: user.displayName,
                email: user.email
            });

            // Update user panel in navbar
            updateUserPanel(user);

            // Hide registration button and show user panel
            document.getElementById('registerButton').classList.add('hidden');
            document.getElementById('userPanel').classList.remove('hidden');

            // Check if user has completed registration (has name and phone)
            checkUserRegistrationStatus(user.uid);
        }

        // Function to update student dashboard with user data
        async function updateStudentDashboard(userData) {
            // Update profile information
            document.getElementById('dashboardFullName').textContent = userData.fullName || userData.displayName || 'N/A';
            document.getElementById('dashboardEmailText').textContent = userData.email || 'N/A';
            document.getElementById('dashboardPhoneText').textContent = userData.phone || 'N/A';

            // Format join date
            if (userData.createdAt) {
                const date = new Date(userData.createdAt);
                document.getElementById('joinDateText').textContent = date.toLocaleDateString('id-ID');
            }

            // Load and display payment information
            await loadStudentPaymentInfo(userData.uid, userData.fullName, userData.email);

            // Check payment status and show/hide menus accordingly
            await checkPaymentStatusAndShowMenus(userData.uid);

            // Show student dashboard and hide main content
            document.getElementById('studentDashboard').classList.remove('hidden');
            document.getElementById('instructorDashboard').classList.add('hidden');
            document.querySelectorAll('.hidden-on-login').forEach(el => {
                el.classList.add('hidden');
            });
        }

        // Function to check payment status and show/hide menus
        async function checkPaymentStatusAndShowMenus(studentId) {
            try {
                // Get student's payment status
                const studentRef = database.ref(`students/${studentId}`);
                const studentSnapshot = await studentRef.once('value');
                const studentData = studentSnapshot.val();

                const paymentStatus = studentData?.paymentStatus || 'pending';

                // Show/hide payment and session menus based on payment status
                if (paymentStatus === 'paid_dp' || paymentStatus === 'paid') {
                    // Show payment history and session schedule sections
                    const paymentSection = document.getElementById('paymentHistorySection');
                    const sessionSection = document.getElementById('upcomingSessionsSection');

                    if (paymentSection) paymentSection.classList.remove('hidden');
                    if (sessionSection) sessionSection.classList.remove('hidden');

                    // Load payment history and upcoming sessions
                    await loadPaymentHistory(studentId);
                    await loadUpcomingSessions(studentId);
                } else {
                    // Hide payment history and session schedule sections
                    const paymentSection = document.getElementById('paymentHistorySection');
                    const sessionSection = document.getElementById('upcomingSessionsSection');

                    if (paymentSection) paymentSection.classList.add('hidden');
                    if (sessionSection) sessionSection.classList.add('hidden');

                    // Show message about completing DP payment
                    const messageContainer = document.createElement('div');
                    messageContainer.className = 'bg-amber-500/10 border border-amber-500/30 rounded-xl p-6 mb-8 text-center';
                    messageContainer.id = 'paymentRequiredMessage';
                    messageContainer.innerHTML = `
                        <i class="fa-solid fa-exclamation-triangle text-amber-500 text-3xl mb-4"></i>
                        <h3 class="text-xl font-bold text-amber-400 mb-2">Pembayaran DP Diperlukan</h3>
                        <p class="text-slate-300 mb-4">Lakukan pembayaran DP (20%) untuk mengakses riwayat pembayaran dan jadwal sesi</p>
                        <button onclick="openRegistrationForm()" class="px-6 py-3 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg shadow-lg transition">
                            Upload Bukti Pembayaran DP
                        </button>
                    `;

                    // Insert the message after the progress section
                    const progressSection = document.querySelector('.progress-section');
                    if (progressSection) {
                        // Remove any existing message
                        const existingMessage = document.getElementById('paymentRequiredMessage');
                        if (existingMessage) {
                            existingMessage.remove();
                        }

                        progressSection.insertAdjacentElement('afterend', messageContainer);
                    }
                }
            } catch (error) {
                console.error('Error checking payment status:', error);
            }
        }

        // Function to update user panel in navbar
        function updateUserPanel(user) {
            // Update user avatar
            const userAvatar = document.getElementById('userAvatar');
            if (user.photoURL) {
                userAvatar.innerHTML = `<img src="${user.photoURL}" alt="Profile" class="w-8 h-8 rounded-full">`;
            } else {
                userAvatar.innerHTML = `<i class="fa-solid fa-user"></i>`;
            }

            // Update user name
            const userNameDisplay = document.getElementById('userNameDisplay');
            userNameDisplay.textContent = user.displayName || user.email.split('@')[0]; // Use email prefix if no display name

            // Set dashboard link based on user role
            const dashboardButton = document.getElementById('dashboardButton');
            dashboardButton.href = "#"; // Will be handled by JavaScript
            dashboardButton.onclick = function(e) {
                e.preventDefault();
                // This will be handled by the existing dashboard display logic
                if (auth.currentUser) {
                    checkUserRegistrationStatus(auth.currentUser.uid);
                }
            };

            // Show dashboard and logout buttons
            document.getElementById('dashboardButton').classList.remove('hidden');
            document.getElementById('logoutButton').classList.remove('hidden');
        }

        // Function to check if user has completed registration
        async function checkUserRegistrationStatus(uid) {
            try {
                const userSnapshot = await database.ref('users/' + uid).once('value');
                const userData = userSnapshot.val();

                if (userData && userData.fullName && userData.phone) {
                    // User has completed registration, show appropriate dashboard based on role
                    showAppropriateDashboard(userData);

                    // Update UI to show dashboard/logout buttons instead of register button
                    updateRegisteredUserUI();
                } else {
                    // User needs to complete registration, show registration modal
                    openRegistrationForm();
                }
            } catch (error) {
                console.error('Error checking user registration status:', error);
            }
        }

        // Function to update UI for registered users
        function updateRegisteredUserUI() {
            // Hide the register button
            const registerButton = document.getElementById('registerButton');
            if (registerButton) {
                registerButton.classList.add('hidden');
            }

            // Show dashboard and logout buttons if they exist
            const dashboardButton = document.getElementById('dashboardButton');
            const logoutButton = document.getElementById('logoutButton');

            if (dashboardButton) {
                dashboardButton.classList.remove('hidden');
            }

            if (logoutButton) {
                logoutButton.classList.remove('hidden');
            }
        }

        // Function to show student dashboard
        async function showStudentDashboard(userData) {
            await updateStudentDashboard(userData);
        }

        // Function to load and display student payment information
        async function loadStudentPaymentInfo(studentId, studentName, studentEmail) {
            try {
                // Get payment plan for the student
                const paymentPlan = await getStudentPaymentPlan(studentId);

                if (!paymentPlan) {
                    // Create a default payment plan if none exists
                    await createPaymentPlan(studentId, studentName, studentEmail);
                    // Re-fetch the newly created plan
                    const newPlan = await getStudentPaymentPlan(studentId);
                    updatePaymentDisplay(newPlan);
                } else {
                    updatePaymentDisplay(paymentPlan);
                }
            } catch (error) {
                console.error('Error loading payment info:', error);
                // Set default values if there's an error
                document.getElementById('overallPaymentStatus').textContent = 'Error Memuat';
                document.getElementById('dpStatus').className = 'px-2 py-1 text-xs rounded-full bg-red-900/30 text-red-400';
                document.getElementById('dpStatus').textContent = 'Error';
                document.getElementById('installmentStatus').className = 'px-2 py-1 text-xs rounded-full bg-red-900/30 text-red-400';
                document.getElementById('installmentStatus').textContent = 'Error';
            }
        }

        // Function to update payment display based on payment plan
        function updatePaymentDisplay(paymentPlan) {
            // Update down payment info
            document.getElementById('dpDueDate').textContent = `Jatuh tempo: ${paymentPlan.downPayment.dueDate}`;

            const dpStatusEl = document.getElementById('dpStatus');
            const dpPayButton = document.getElementById('dpPayButton');

            if (paymentPlan.downPayment.status === 'paid') {
                dpStatusEl.className = 'px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400';
                dpStatusEl.textContent = 'Lunas';
                dpPayButton.classList.add('hidden');
            } else {
                dpStatusEl.className = 'px-2 py-1 text-xs rounded-full bg-yellow-900/30 text-yellow-400';
                dpStatusEl.textContent = 'Pending';
                dpPayButton.classList.remove('hidden');
            }

            // Update installments info
            const paidInstallments = paymentPlan.installments.filter(inst => inst.status === 'paid').length;
            const totalInstallments = paymentPlan.installments.length;
            const pendingInstallments = totalInstallments - paidInstallments;

            document.getElementById('installmentInfo').textContent = `Sisa: ${pendingInstallments}/${totalInstallments}`;

            const installmentStatusEl = document.getElementById('installmentStatus');
            const installmentPayButton = document.getElementById('installmentPayButton');

            if (paidInstallments === totalInstallments) {
                installmentStatusEl.className = 'px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400';
                installmentStatusEl.textContent = 'Lunas';
                installmentPayButton.classList.add('hidden');
            } else if (paidInstallments > 0) {
                installmentStatusEl.className = 'px-2 py-1 text-xs rounded-full bg-blue-900/30 text-blue-400';
                installmentStatusEl.textContent = 'Sebagian';
                installmentPayButton.classList.remove('hidden');
            } else {
                installmentStatusEl.className = 'px-2 py-1 text-xs rounded-full bg-yellow-900/30 text-yellow-400';
                installmentStatusEl.textContent = 'Pending';
                installmentPayButton.classList.remove('hidden');
            }

            // Calculate overall payment status
            let overallStatus = 'Belum Dibayar';
            let progressPercent = 0;

            if (paymentPlan.downPayment.status === 'paid' && paidInstallments === totalInstallments) {
                overallStatus = 'Lunas';
                progressPercent = 100;
            } else if (paymentPlan.downPayment.status === 'paid' || paidInstallments > 0) {
                overallStatus = 'Sebagian Dibayar';
                // Calculate progress: down payment (20%) + installments (80% total)
                const installmentProgress = (paidInstallments / totalInstallments) * 80;
                progressPercent = paymentPlan.downPayment.status === 'paid' ? 20 + installmentProgress : installmentProgress;
            }

            document.getElementById('overallPaymentStatus').textContent = overallStatus;
            document.getElementById('paymentProgressBar').style.width = `${progressPercent}%`;

            // Add event listeners to payment buttons
            document.getElementById('dpPayButton').onclick = async () => {
                // In a real app, this would redirect to payment gateway
                // For demo, we'll just mark as paid
                await recordPayment(studentId, 'down_payment', paymentPlan.downPayment.amount);
                // Refresh the payment display
                const updatedPlan = await getStudentPaymentPlan(studentId);
                updatePaymentDisplay(updatedPlan);
                // Also reload payment history
                await loadPaymentHistory(studentId);
                alert('Pembayaran DP berhasil dicatat!');
            };

            document.getElementById('installmentPayButton').onclick = async () => {
                // Find the next pending installment
                const nextPendingInstallment = paymentPlan.installments.find(inst => inst.status === 'pending');
                if (nextPendingInstallment) {
                    // In a real app, this would redirect to payment gateway
                    // For demo, we'll just mark the next installment as paid
                    await recordPayment(studentId, nextPendingInstallment.id, nextPendingInstallment.amount);
                    // Refresh the payment display
                    const updatedPlan = await getStudentPaymentPlan(studentId);
                    updatePaymentDisplay(updatedPlan);
                    // Also reload payment history
                    await loadPaymentHistory(studentId);
                    alert(`Pembayaran cicilan ${nextPendingInstallment.id} berhasil dicatat!`);
                } else {
                    alert('Tidak ada cicilan yang perlu dibayar');
                }
            };

            // Load payment history after updating display
            loadPaymentHistory(studentId);
        }

        // Function to load upcoming sessions for a student
        async function loadUpcomingSessions(studentId) {
            try {
                // Get all sessions from Firebase
                const sessionsRef = database.ref('sessions');
                const sessionsSnapshot = await sessionsRef.once('value');
                const sessions = sessionsSnapshot.val() || {};

                const sessionsList = document.getElementById('upcomingSessionsList');

                // Convert to array and filter for upcoming sessions
                const sessionArray = [];
                for (const [id, session] of Object.entries(sessions)) {
                    sessionArray.push({ id, ...session });
                }

                // Filter for upcoming sessions (today or later) and sort by date
                const now = new Date();
                const upcomingSessions = sessionArray.filter(session => {
                    const sessionDateTime = new Date(`${session.date}T${session.time}`);
                    return sessionDateTime >= now;
                });

                // Sort by date and time ascending
                upcomingSessions.sort((a, b) => {
                    const dateA = new Date(`${a.date}T${a.time}`);
                    const dateB = new Date(`${b.date}T${b.time}`);
                    return dateA - dateB;
                });

                if (upcomingSessions.length === 0) {
                    sessionsList.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fa-solid fa-calendar-day text-slate-500 text-3xl mb-2"></i>
                            <p class="text-slate-400">Tidak ada sesi mendatang</p>
                        </div>
                    `;
                    return;
                }

                // Generate HTML for each session
                let sessionsHtml = '';
                upcomingSessions.slice(0, 3).forEach(session => { // Show only first 3
                    const sessionDateTime = new Date(`${session.date}T${session.time}`);
                    const formattedDateTime = sessionDateTime.toLocaleDateString('id-ID', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    let typeIcon, typeColor, typeText;
                    if (session.type === 'offline') {
                        typeIcon = 'fa-building';
                        typeColor = 'bg-blue-500/10 text-blue-400';
                        typeText = 'Offline';
                    } else {
                        typeIcon = 'fa-video';
                        typeColor = 'bg-purple-500/10 text-purple-400';
                        typeText = 'Online';
                    }

                    sessionsHtml += `
                        <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-600">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="font-bold text-white">${session.title}</h3>
                                        <span class="px-2 py-1 text-xs rounded-full ${typeColor}">
                                            <i class="fa-solid ${typeIcon}"></i> ${typeText}
                                        </span>
                                    </div>
                                    <p class="text-slate-400 text-sm mb-2">${formattedDateTime}</p>

                                    ${session.type === 'offline' ?
                                        `<div class="flex items-center gap-2 text-sm text-slate-300">
                                            <i class="fa-solid fa-location-dot text-slate-500"></i>
                                            <span>${session.location || 'Lokasi belum ditentukan'}</span>
                                        </div>` :
                                        `<div class="flex items-center gap-2 text-sm text-slate-300">
                                            <i class="fa-solid fa-link text-slate-500"></i>
                                            <a href="${session.link || '#'}" target="_blank" class="text-brand-400 hover:underline">${session.platform || 'Platform belum ditentukan'}</a>
                                        </div>`
                                    }
                                </div>
                                <div class="text-right">
                                    <button class="px-3 py-1 bg-amber-600 hover:bg-amber-700 text-white text-xs rounded-lg transition">
                                        Hadiri
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                sessionsList.innerHTML = sessionsHtml;
            } catch (error) {
                console.error('Error loading upcoming sessions:', error);
                document.getElementById('upcomingSessionsList').innerHTML = `
                    <div class="text-center py-4 text-red-400">
                        <i class="fa-solid fa-exclamation-circle text-2xl mb-2"></i>
                        <p>Terjadi kesalahan saat memuat jadwal sesi</p>
                    </div>
                `;
            }
        }

        // Function to load payment history for a student
        async function loadPaymentHistory(studentId) {
            try {
                // Get payment history from Firebase
                const historyRef = database.ref('payment_history');
                const historySnapshot = await historyRef.orderByChild('studentId').equalTo(studentId).once('value');
                const history = historySnapshot.val() || {};

                const historyList = document.getElementById('paymentHistoryList');

                // Convert to array and sort by timestamp (newest first)
                const historyArray = [];
                for (const [id, record] of Object.entries(history)) {
                    historyArray.push({ id, ...record });
                }

                // Sort by timestamp descending
                historyArray.sort((a, b) => b.timestamp - a.timestamp);

                if (historyArray.length === 0) {
                    historyList.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fa-solid fa-receipt text-slate-500 text-3xl mb-2"></i>
                            <p class="text-slate-400">Belum ada riwayat pembayaran</p>
                        </div>
                    `;
                    return;
                }

                // Generate HTML for each payment record
                let historyHtml = '';
                historyArray.forEach(record => {
                    const date = new Date(record.timestamp);
                    const formattedDate = date.toLocaleDateString('id-ID', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    let statusBadge = '';
                    if (record.paymentType === 'down_payment') {
                        statusBadge = `<span class="px-2 py-1 text-xs rounded-full bg-amber-900/30 text-amber-400">Down Payment</span>`;
                    } else if (record.paymentType.startsWith('installment_')) {
                        statusBadge = `<span class="px-2 py-1 text-xs rounded-full bg-emerald-900/30 text-emerald-400">Cicilan</span>`;
                    } else {
                        statusBadge = `<span class="px-2 py-1 text-xs rounded-full bg-slate-900/30 text-slate-400">${record.paymentType}</span>`;
                    }

                    historyHtml += `
                        <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-600">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="font-bold text-white">${record.description}</h3>
                                        ${statusBadge}
                                    </div>
                                    <p class="text-slate-400 text-sm mb-2">${formattedDate}</p>
                                    <p class="text-emerald-400 font-bold">Rp ${record.amount.toLocaleString('id-ID')}</p>
                                </div>
                                <div class="text-right">
                                    <span class="px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400">Lunas</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                historyList.innerHTML = historyHtml;
            } catch (error) {
                console.error('Error loading payment history:', error);
                document.getElementById('paymentHistoryList').innerHTML = `
                    <div class="text-center py-4 text-red-400">
                        <i class="fa-solid fa-exclamation-circle text-2xl mb-2"></i>
                        <p>Terjadi kesalahan saat memuat riwayat pembayaran</p>
                    </div>
                `;
            }
        }

        // Function to show instructor dashboard
        function showInstructorDashboard(userData) {
            // Update instructor dashboard with user data
            document.getElementById('instructorName').textContent = userData.fullName || userData.displayName || 'N/A';
            document.getElementById('instructorEmailText').textContent = userData.email || 'N/A';

            // Load instructor dashboard data
            loadInstructorDashboardData(userData.uid);

            // Show instructor dashboard and hide main content
            document.getElementById('instructorDashboard').classList.remove('hidden');
            document.getElementById('studentDashboard').classList.add('hidden');
            document.querySelectorAll('.hidden-on-login').forEach(el => {
                el.classList.add('hidden');
            });
        }

        // Function to load instructor dashboard data
        async function loadInstructorDashboardData(instructorUid) {
            try {
                // Get all students
                const studentsSnapshot = await database.ref('students').once('value');
                const students = studentsSnapshot.val() || {};

                // Update stats
                document.getElementById('totalStudents').textContent = Object.keys(students).length;

                // For demo purposes, showing some active students
                document.getElementById('activeStudents').textContent = Object.keys(students).filter(uid => {
                    // In a real app, you would check actual activity status
                    return true;
                }).length;

                // Update live sessions count
                document.getElementById('liveSessions').textContent = '3';

                // Update completion rate
                document.getElementById('completionRate').textContent = '65%';

                // Populate students table
                const studentsTableBody = document.getElementById('studentsTableBody');
                studentsTableBody.innerHTML = '';

                for (const [uid, studentData] of Object.entries(students)) {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-slate-700 hover:bg-slate-750';

                    // Calculate progress percentage (demo data)
                    const progress = Math.floor(Math.random() * 100);

                    // Get payment status for this student
                    let paymentStatus = 'Belum Ada';
                    let paymentStatusClass = 'bg-gray-900/30 text-gray-400';

                    // In a real app, we would fetch the actual payment status
                    // For demo, we'll use random statuses
                    const statuses = ['Lunas', 'Sebagian', 'Pending'];
                    const statusClasses = ['bg-green-900/30 text-green-400', 'bg-yellow-900/30 text-yellow-400', 'bg-red-900/30 text-red-400'];
                    const randomIndex = Math.floor(Math.random() * statuses.length);
                    paymentStatus = statuses[randomIndex];
                    paymentStatusClass = statusClasses[randomIndex];

                    row.innerHTML = `
                        <td class="px-4 py-3 font-medium text-white">${studentData.fullName || 'N/A'}</td>
                        <td class="px-4 py-3">${studentData.email || 'N/A'}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400">Aktif</span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex items-center">
                                <div class="w-24 bg-slate-700 rounded-full h-2.5 mr-2">
                                    <div class="bg-brand-600 h-2.5 rounded-full" style="width: ${progress}%"></div>
                                </div>
                                <span>${progress}%</span>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs rounded-full ${paymentStatusClass}">${paymentStatus}</span>
                            <button onclick="openPaymentValidationModal('${uid}', '${studentData.fullName || 'N/A'}')" class="ml-2 text-xs text-blue-400 hover:text-blue-300">
                                <i class="fa-solid fa-check"></i> Validasi
                            </button>
                        </td>
                        <td class="px-4 py-3">
                            <button class="text-blue-400 hover:text-blue-300 text-sm">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </td>
                    `;

                    studentsTableBody.appendChild(row);
                }

                // Load scheduled sessions
                loadScheduledSessions(instructorUid);

                // Populate recent activities
                const recentActivity = document.getElementById('recentActivity');
                recentActivity.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="bg-blue-500/10 p-2 rounded-lg">
                            <i class="fa-solid fa-user-plus text-blue-400"></i>
                        </div>
                        <div>
                            <p class="text-slate-300">Ahmad S. mendaftar ke bootcamp</p>
                            <p class="text-xs text-slate-500">2 jam yang lalu</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="bg-green-500/10 p-2 rounded-lg">
                            <i class="fa-solid fa-graduation-cap text-green-400"></i>
                        </div>
                        <div>
                            <p class="text-slate-300">Budi P. menyelesaikan modul Docker</p>
                            <p class="text-xs text-slate-500">5 jam yang lalu</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="bg-purple-500/10 p-2 rounded-lg">
                            <i class="fa-solid fa-comments text-purple-400"></i>
                        </div>
                        <div>
                            <p class="text-slate-300">Diskusi baru di forum: "React Native Tips"</p>
                            <p class="text-xs text-slate-500">1 hari yang lalu</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading instructor dashboard data:', error);
            }
        }

        // Function to determine user role and show appropriate dashboard
        async function showAppropriateDashboard(userData) {
            // Check if user is an instructor by looking at their role in the database
            try {
                const userSnapshot = await database.ref('users/' + userData.uid).once('value');
                const dbUserData = userSnapshot.val();

                if (dbUserData && dbUserData.role === 'instructor') {
                    showInstructorDashboard(dbUserData);
                } else {
                    // Default to student role if not specified
                    showStudentDashboard(dbUserData || userData);
                }
            } catch (error) {
                console.error('Error determining user role:', error);
                // Default to student dashboard if there's an error
                showStudentDashboard(userData);
            }
        }

        // Check if user is already logged in when page loads
        window.addEventListener('load', async () => {
            const savedUser = localStorage.getItem('firebaseUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                // Update UI to show logged in state
                updateUIAfterLogin(user);

                // Check if user has completed registration and show appropriate dashboard
                if (auth.currentUser) {
                    await checkUserRegistrationStatus(auth.currentUser.uid);
                }
            } else {
                // If no saved user, ensure UI is in logged out state
                updateUIAfterLogout();
            }
        });

        // Listen for auth state changes
        auth.onAuthStateChanged(async user => {
            if (user) {
                // User is signed in
                updateUIAfterLogin(user);

                // Check if user has completed registration and show appropriate dashboard
                await checkUserRegistrationStatus(user.uid);
            } else {
                // User is signed out
                updateUIAfterLogout();
            }
        });
    </script>
</body>
</html>


